<UserControl x:Class="Finly.Views.Controls.DonutChartControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignWidth="520"
             d:DesignHeight="240">

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="220"/>
		</Grid.ColumnDefinitions>

		<!-- ===== LEFT: DONUT ===== -->
		<Grid Grid.Column="0">
			<Canvas x:Name="ChartCanvas"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Background="Transparent"
                    ClipToBounds="True"/>

			<!-- CENTER PANEL -->
			<Border x:Name="CenterPanel"
                    Background="{DynamicResource Surface.Background}"
                    Opacity="0.92"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="Collapsed"
                    Panel.ZIndex="100">
				<StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Margin="10">
					<TextBlock x:Name="CenterTitleText"
                               Text=""
                               TextAlignment="Center"
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource App.Foreground}"
                               Margin="6,0,6,6"
                               TextWrapping="Wrap"
                               TextTrimming="CharacterEllipsis"/>

					<TextBlock x:Name="CenterValueText"
                               Text=""
                               TextAlignment="Center"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{DynamicResource App.Foreground}"
                               Margin="6,0,6,4"
                               TextTrimming="CharacterEllipsis"/>

					<TextBlock x:Name="CenterPercentText"
                               Text=""
                               TextAlignment="Center"
                               FontSize="12"
                               Opacity="0.85"
                               Foreground="{DynamicResource App.Foreground}"
                               Margin="6,0,6,0"
                               TextTrimming="CharacterEllipsis"/>
				</StackPanel>
			</Border>

			<!-- NO DATA -->
			<TextBlock x:Name="NoDataText"
                       Text="Brak danych"
                       FontStyle="Italic"
                       Foreground="{DynamicResource App.Foreground}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Visibility="Collapsed"/>
		</Grid>

		<!-- ===== RIGHT: LEGEND ===== -->
		<Border Grid.Column="1"
                Margin="12,0,0,0"
                Background="Transparent"
                BorderBrush="{DynamicResource Surface.Border}"
                BorderThickness="1"
                CornerRadius="10"
                Padding="10">

			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
				</Grid.RowDefinitions>

				<TextBlock x:Name="LegendHeader"
                           Text="Legenda"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource App.Foreground}"
                           Opacity="0.9"
                           Margin="0,0,0,8"/>

				<ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
					<ItemsControl x:Name="LegendList">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border CornerRadius="8"
                                        Padding="6"
                                        Margin="0,0,0,6"
                                        Background="Transparent">
									<Grid>
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="18"/>
											<ColumnDefinition Width="*"/>
											<ColumnDefinition Width="Auto"/>
										</Grid.ColumnDefinitions>

										<Ellipse Width="10" Height="10"
                                                 VerticalAlignment="Center"
                                                 Fill="{Binding Brush}"/>

										<StackPanel Grid.Column="1" Margin="8,0,8,0">
											<TextBlock Text="{Binding Name}"
                                                       Foreground="{DynamicResource App.Foreground}"
                                                       TextTrimming="CharacterEllipsis"/>
											<TextBlock Text="{Binding PercentStr}"
                                                       Foreground="{DynamicResource App.Foreground}"
                                                       Opacity="0.75"
                                                       FontSize="11"/>
										</StackPanel>

										<TextBlock Grid.Column="2"
                                                   Text="{Binding AmountStr}"
                                                   Foreground="{DynamicResource App.Foreground}"
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center"/>
									</Grid>

									<Border.Style>
										<Style TargetType="Border">
											<Setter Property="Opacity" Value="0.92"/>
											<Style.Triggers>
												<DataTrigger Binding="{Binding IsSelected}" Value="True">
													<Setter Property="Opacity" Value="1"/>
													<Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
												</DataTrigger>
											</Style.Triggers>
										</Style>
									</Border.Style>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>
			</Grid>
		</Border>
	</Grid>
</UserControl>
