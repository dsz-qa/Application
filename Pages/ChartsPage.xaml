<UserControl x:Class="Finly.Pages.ChartsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="http://livecharts.com"
             xmlns:lvcwpf="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:vc="clr-namespace:Finly.Views.Controls"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True"
             TextOptions.TextFormattingMode="Display"
             TextOptions.TextRenderingMode="ClearType">

    <UserControl.Resources>

        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>

        <Style x:Key="CardHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Spójny styl dla wykresów: najważniejsze jest DrawMargin, żeby nie ucinało osi/etykiet -->
        <Style x:Key="BaseCartesianChart" TargetType="{x:Type lvcwpf:CartesianChart}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            <Setter Property="LegendPosition" Value="Hidden"/>
            <Setter Property="DrawMargin" Value="46,16,16,34"/>
            <Setter Property="AnimationsSpeed" Value="0:0:0.35"/>
        </Style>

    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  CanContentScroll="True">

        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- GÓRNY PASEK -->
            <Border Grid.Row="0"
                    Style="{StaticResource Card}"
                    Margin="0,0,0,12">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Eksport -->
                    <StackPanel Grid.Column="0"
                                Orientation="Vertical"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">
                        <Button Content="Eksport do PDF"
                                Click="ExportPdf_Click"
                                Style="{StaticResource PrimaryButton}"
                                Width="180"
                                Height="42"
                                Margin="0,0,0,8"/>
                        <Button Content="Eksport do CSV"
                                Click="ExportCsv_Click"
                                Style="{StaticResource PrimaryButton}"
                                Width="180"
                                Height="42"/>
                    </StackPanel>

                    <!-- Okres -->
                    <vc:PeriodBarControl Grid.Column="1"
                                         x:Name="PeriodBar"
                                         HorizontalAlignment="Center"/>

                    <!-- Tryby: ALL / wydatki / przychody / transfer -->
                    <StackPanel Grid.Column="2"
                                Orientation="Vertical"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">

                        <Button x:Name="ModeAllBtn"
                                Tag="All"
                                Click="Mode_Click"
                                Width="200"
                                Height="56"
                                Margin="0,0,0,10"
                                Background="{DynamicResource Brand.Blue}"
                                Foreground="White"
                                BorderBrush="{DynamicResource Brand.Blue}"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center">
                                <TextBlock Text="Wszystkie transakcje"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="ModeExpensesBtn"
                                Tag="Expenses"
                                Click="Mode_Click"
                                Width="200"
                                Height="56"
                                Margin="0,0,0,10"
                                Background="{DynamicResource Brand.Blue}"
                                Foreground="White"
                                BorderBrush="{DynamicResource Brand.Blue}"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center">
                                <Image Source="/Assets/Icons/wydatki.png"
                                       Width="22"
                                       Height="22"
                                       Stretch="Uniform"
                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Wydatki" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="ModeIncomesBtn"
                                Tag="Incomes"
                                Click="Mode_Click"
                                Width="200"
                                Height="56"
                                Margin="0,0,0,10"
                                Background="{DynamicResource Brand.Blue}"
                                Foreground="White"
                                BorderBrush="{DynamicResource Brand.Blue}"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center">
                                <Image Source="/Assets/Icons/przychody.png"
                                       Width="22"
                                       Height="22"
                                       Stretch="Uniform"
                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Przychody" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="ModeTransferBtn"
                                Tag="Transfer"
                                Click="Mode_Click"
                                Width="200"
                                Height="56"
                                Background="{DynamicResource Brand.Blue}"
                                Foreground="White"
                                BorderBrush="{DynamicResource Brand.Blue}"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center">
                                <Image Source="/Assets/Icons/transfer.png"
                                       Width="22"
                                       Height="22"
                                       Stretch="Uniform"
                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Transfery" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                    </StackPanel>
                </Grid>
            </Border>

            <!-- DÓŁ: WYKRESY -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- RZĄD 1 -->
                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="Podział według kategorii"
                                   Style="{StaticResource CardHeader}" />

                        <!-- Donut -->
                        <vc:DonutChartControl Grid.Row="1"
                                              x:Name="CategoriesDonut"
                                              Height="260"
                                              Title="Wszystkie transakcje — podział"/>

                        <!-- Placeholder dla Transferów -->
                        <TextBlock x:Name="TransferCategoryHint"
                                   Grid.Row="1"
                                   Visibility="Collapsed"
                                   TextWrapping="Wrap"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Opacity="0.8"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"
                                   Margin="8"
                                   Text="Dla transferów podział według kategorii nie ma sensu. Ten wykres jest ukryty w trybie „Transfery”."/>
                    </Grid>
                </Border>

                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Trend w czasie" Style="{StaticResource CardHeader}"/>

                        <lvcwpf:CartesianChart x:Name="TrendChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding TrendSeries}"
                                               XAxes="{Binding TrendXAxes}"
                                               Height="260"/>
                    </StackPanel>
                </Border>

                <!-- RZĄD 2 -->
                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Według wolnej gotówki" Style="{StaticResource CardHeader}"/>
                        <lvcwpf:CartesianChart x:Name="FreeCashChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding FreeCashSeries}"
                                               XAxes="{Binding FreeCashXAxes}"
                                               Height="200"/>
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Według odłożonej gotówki" Style="{StaticResource CardHeader}"/>
                        <lvcwpf:CartesianChart x:Name="SavedCashChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding SavedCashSeries}"
                                               XAxes="{Binding SavedCashXAxes}"
                                               Height="200"/>
                    </StackPanel>
                </Border>

                <!-- RZĄD 3 -->
                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Według kont bankowych" Style="{StaticResource CardHeader}"/>
                        <lvcwpf:CartesianChart x:Name="BankAccountsChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding BankAccountsSeries}"
                                               XAxes="{Binding BankAccountsXAxes}"
                                               Height="260"/>
                    </StackPanel>
                </Border>

                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Według kopert" Style="{StaticResource CardHeader}"/>
                        <lvcwpf:CartesianChart x:Name="EnvelopesChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding EnvelopesSeries}"
                                               XAxes="{Binding EnvelopesXAxes}"
                                               Height="260"/>
                    </StackPanel>
                </Border>

                <!-- RZĄD 4 -->
                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Według dnia tygodnia" Style="{StaticResource CardHeader}"/>
                        <lvcwpf:CartesianChart x:Name="WeekdayChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding WeekdaySeries}"
                                               XAxes="{Binding WeekdayXAxes}"
                                               Height="260"/>
                    </StackPanel>
                </Border>

                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Liczba transakcji wg przedziału kwot" Style="{StaticResource CardHeader}"/>
                        <lvcwpf:CartesianChart x:Name="AmountBucketsChart"
                                               Style="{StaticResource BaseCartesianChart}"
                                               Series="{Binding AmountBucketsSeries}"
                                               XAxes="{Binding AmountBucketsXAxes}"
                                               YAxes="{Binding AmountBucketsYAxes}"
                                               Height="260"/>
                    </StackPanel>
                </Border>

            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>
