<UserControl x:Class="Finly.Pages.BudgetsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:Finly.Views.Controls">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>    <!-- Header -->
            <RowDefinition Height="Auto"/>    <!-- New container placeholder -->
            <RowDefinition Height="Auto"/>    <!-- Controls (add budget etc.) -->
            <RowDefinition Height="*"/>    <!-- Budgets list -->
        </Grid.RowDefinitions>

        <Grid.Resources>
            <!-- Budget card template -->
            <DataTemplate x:Key="BudgetItemTemplate">
                <Border BorderBrush="{DynamicResource Brand.Blue}" BorderThickness="2" CornerRadius="10" Padding="12" Margin="0,0,0,12" Background="{DynamicResource Surface.Background}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- Header: category name -->
                        <TextBlock Grid.Row="0" Grid.Column="0" FontWeight="Bold" FontSize="14" Foreground="{DynamicResource App.Foreground}">
                            <TextBlock.Text>
                                <PriorityBinding>
                                    <Binding Path="CategoryName"/>
                                    <Binding Path="Name"/>
                                </PriorityBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        <!-- action buttons -->
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Style="{StaticResource TitleBarIconButton}" ToolTip="Edytuj" Margin="0,0,6,0">
                                <Image Source="/Assets/Images/edit.png" Width="20" Height="20" Stretch="Uniform"/>
                            </Button>
                            <Button Style="{StaticResource TitleBarIconButton}" ToolTip="Usuń">
                                <Image Source="/Assets/Images/delete.png" Width="20" Height="20" Stretch="Uniform"/>
                            </Button>
                        </StackPanel>
                        <!-- row: limit/spent/remaining -->
                        <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,6,0,6">
                            <TextBlock Text="{Binding Limit, StringFormat=Limit: {0} zł}" Foreground="{DynamicResource App.Foreground}"/>
                            <TextBlock Text="{Binding Spent, StringFormat= • Wydano: {0} zł}" Foreground="{DynamicResource App.Foreground}" Margin="8,0,0,0"/>
                            <TextBlock Text="{Binding Remaining, StringFormat= • Pozostało: {0} zł}" Foreground="{DynamicResource App.Foreground}" Margin="8,0,0,0"/>
                        </StackPanel>
                        <!-- progress bar -->
                        <ProgressBar Grid.Row="2" Grid.ColumnSpan="2" Height="16" Minimum="0" Value="{Binding Spent}" Maximum="{Binding Limit}" Margin="0,0,0,0"/>
                    </Grid>
                </Border>
            </DataTemplate>

            <Style x:Key="PeriodSelectorRadioStyle" TargetType="RadioButton">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Margin" Value="0,0,12,0"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RadioButton">
                            <Border x:Name="Outer" Padding="10,6" CornerRadius="20" BorderThickness="2" BorderBrush="{DynamicResource Surface.Border}" Background="{DynamicResource Surface.Background}">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Ellipse x:Name="Dot" Width="14" Height="14" StrokeThickness="2" Stroke="{DynamicResource Surface.Border}" Fill="Transparent"/>
                                    <TextBlock Text="{TemplateBinding Content}" Margin="8,0,0,0" FontSize="13" Foreground="{DynamicResource App.Foreground}"/>
                                </StackPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="Outer" Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
                                    <Setter TargetName="Outer" Property="Background" Value="{DynamicResource Brand.Blue}"/>
                                    <Setter TargetName="Dot" Property="Fill" Value="{DynamicResource Accent.Foreground}"/>
                                    <Setter TargetName="Dot" Property="Stroke" Value="{DynamicResource Accent.Foreground}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource Accent.Foreground}"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Outer" Property="Background" Value="{DynamicResource Btn.Hover}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding SelectedPeriod}" Value="Week">
                        <Setter Property="IsChecked" Value="True"/>
                        <Setter Property="Tag" Value="Week"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedPeriod}" Value="Month">
                        <Setter Property="IsChecked" Value="True"/>
                        <Setter Property="Tag" Value="Month"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedPeriod}" Value="Quarter">
                        <Setter Property="IsChecked" Value="True"/>
                        <Setter Property="Tag" Value="Quarter"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedPeriod}" Value="Year">
                        <Setter Property="IsChecked" Value="True"/>
                        <Setter Property="Tag" Value="Year"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Resources>

        <!-- Header -->
        <TextBlock Text="Budżety" FontSize="18" FontWeight="Bold"/>

        <!-- New empty container for future period selector, navigation arrows, summary tile, and budgets list header -->
        <Grid Grid.Row="1" Margin="0,12,0,12" x:Name="TopFiltersContainer">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Period selector -->
                <RowDefinition Height="Auto"/> <!-- Navigation row -->
            </Grid.RowDefinitions>
            <StackPanel Orientation="Horizontal" x:Name="PeriodSelector" HorizontalAlignment="Left">
                <RadioButton Content="Tydzień" Tag="Week" Style="{StaticResource PeriodSelectorRadioStyle}"/>
                <RadioButton Content="Miesiąc" Tag="Month" Style="{StaticResource PeriodSelectorRadioStyle}"/>
                <RadioButton Content="Kwartał" Tag="Quarter" Style="{StaticResource PeriodSelectorRadioStyle}"/>
                <RadioButton Content="Rok" Tag="Year" Style="{StaticResource PeriodSelectorRadioStyle}"/>
            </StackPanel>
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,8,0,0">
                <Button Content="&lt;&lt;" Style="{StaticResource PrimaryButton}" Width="56" Padding="10,6"/>
                <TextBlock Text="{Binding CurrentPeriodName}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}" Margin="12,0,12,0" VerticalAlignment="Center"/>
                <Button Content="&gt;&gt;" Style="{StaticResource PrimaryButton}" Width="56" Padding="10,6"/>
            </StackPanel>
        </Grid>

        <!-- Existing add budget controls -->
        <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,0,0,12" VerticalAlignment="Center" >
            <TextBox x:Name="NameBox" Width="160" />
            <ComboBox x:Name="TypeBox" Width="140" Margin="8,0,0,0">
                <ComboBoxItem Content="Miesięczny" Tag="Monthly" />
                <ComboBoxItem Content="Tygodniowy" Tag="Weekly" />
                <ComboBoxItem Content="Roll-over" Tag="Rollover" />
                <ComboBoxItem Content="Jednorazowy" Tag="OneTime" />
            </ComboBox>
            <ComboBox x:Name="CategoryBox" Width="160" IsEditable="True" Margin="8,0,0,0"/>
            <TextBox x:Name="AmountBox" Width="100" Margin="8,0,0,0"/>
            <Button x:Name="AddBtn" Content="Dodaj budżet" Click="AddBtn_Click" Margin="8,0,0,0"/>
            <Button x:Name="RefreshBtn" Content="Odśwież" Click="RefreshBtn_Click" Margin="8,0,0,0"/>
            <StackPanel Orientation="Vertical" Margin="12,0,0,0">
                <TextBlock Text="Bezpieczeństwo:" FontWeight="SemiBold"/>
                <TextBlock x:Name="SafetyText" Text="—" />
            </StackPanel>
        </StackPanel>

        <!-- Budgets list -->
        <ScrollViewer Grid.Row="3">
            <ItemsControl x:Name="BudgetsItems" ItemTemplate="{StaticResource BudgetItemTemplate}" ItemsSource="{Binding Budgets}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" ItemWidth="350" MinWidth="200" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>