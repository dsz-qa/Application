<UserControl x:Class="Finly.Pages.BudgetsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:Finly.Views.Controls"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             x:Name="Root"
             Background="{DynamicResource App.Background}">

	<UserControl.Resources>

		<Style x:Key="Card" TargetType="Border">
			<Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius" Value="10"/>
			<Setter Property="Padding" Value="12"/>
		</Style>

		<Style x:Key="OrangeCard" TargetType="Border" BasedOn="{StaticResource Card}">
			<Setter Property="BorderBrush" Value="{DynamicResource Brand.Orange}"/>
			<Setter Property="BorderThickness" Value="2"/>
		</Style>

		<Style x:Key="KpiCard" TargetType="Border" BasedOn="{StaticResource Card}">
			<Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="BorderThickness" Value="2"/>
			<Setter Property="Margin" Value="0,0,16,0"/>
		</Style>

		<Style x:Key="CardHeader" TargetType="TextBlock">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
		</Style>

		<Style x:Key="KpiValueStyle" TargetType="TextBlock">
			<Setter Property="FontSize" Value="20"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Margin" Value="0,2,0,0"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
		</Style>

		<Style x:Key="MiniTableHeaderBorder" TargetType="Border">
			<Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
			<Setter Property="Padding" Value="6,4"/>
			<Setter Property="Margin" Value="0,0,0,6"/>
			<Setter Property="CornerRadius" Value="6"/>
		</Style>

		<Style x:Key="MiniTableHeaderText" TargetType="TextBlock">
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Opacity" Value="0.8"/>
			<Setter Property="Margin" Value="6,0,6,0"/>
		</Style>

		<Style x:Key="MiniTableCellText" TargetType="TextBlock">
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Margin" Value="6,2,6,2"/>
			<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
			<Setter Property="TextWrapping" Value="NoWrap"/>
		</Style>

		<Style x:Key="MiniTableCellRight" TargetType="TextBlock" BasedOn="{StaticResource MiniTableCellText}">
			<Setter Property="HorizontalAlignment" Value="Right"/>
			<Setter Property="TextAlignment" Value="Right"/>
		</Style>

		<Style x:Key="AmountPlanned" TargetType="TextBlock" BasedOn="{StaticResource MiniTableCellRight}">
			<Setter Property="Foreground" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
		</Style>

		<Style x:Key="BudgetListItemStyle" TargetType="ListBoxItem">
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Margin" Value="0,2,0,2"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListBoxItem">
						<Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
							<ContentPresenter/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsSelected" Value="True">
								<Setter Property="BorderBrush" Value="{DynamicResource Brand.Orange}"/>
								<Setter Property="BorderThickness" Value="2"/>
							</Trigger>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

	</UserControl.Resources>

	<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
		<Grid Margin="16">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- KPI -->
			<Grid Grid.Row="0" Margin="0,0,0,12">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<Border Grid.Column="0" Style="{StaticResource KpiCard}">
					<StackPanel>
						<TextBlock Text="Aktywne budżety (dzisiaj)" Style="{StaticResource CardHeader}"/>
						<TextBlock x:Name="KpiActiveBudgetsText" Style="{StaticResource KpiValueStyle}" Text="0"/>
					</StackPanel>
				</Border>

				<Border Grid.Column="1" Style="{StaticResource KpiCard}">
					<StackPanel>
						<TextBlock Text="Planowane (aktywne)" Style="{StaticResource CardHeader}"/>
						<TextBlock x:Name="KpiPlannedActiveText" Style="{StaticResource KpiValueStyle}" Text="0,00 zł"/>
					</StackPanel>
				</Border>

				<Border Grid.Column="2" Style="{StaticResource KpiCard}" Margin="0">
					<StackPanel>
						<TextBlock Text="Przekroczone (aktywne)" Style="{StaticResource CardHeader}"/>
						<TextBlock x:Name="KpiOverActiveText" Style="{StaticResource KpiValueStyle}" Text="0 | 0,00 zł"/>
					</StackPanel>
				</Border>
			</Grid>

			<!-- Separator + tytuł -->
			<Separator Grid.Row="1" Height="1" Background="{DynamicResource Surface.Border}" Opacity="0.8" Margin="0,0,0,8"/>
			<TextBlock Grid.Row="1" Text="Budżety" FontSize="24" FontWeight="Bold"
                       Foreground="{DynamicResource App.Foreground}" Margin="0,4,0,12"/>

			<!-- 2 kolumny -->
			<Grid Grid.Row="2">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<!-- LEWA -->
				<Border Grid.Column="0" Style="{StaticResource Card}" Margin="0,0,8,0">
					<StackPanel>

						<TextBlock Text="Wybierz budżet, aby zobaczyć szczegóły"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Opacity="0.9"
                                   Margin="0,0,0,10"/>

						<Grid Margin="0,0,0,10">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="220"/>
								<ColumnDefinition Width="10"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<ComboBox x:Name="TypeFilterCombo"
                                      Grid.Column="0"
                                      SelectionChanged="TypeFilterCombo_SelectionChanged"/>

							<TextBox x:Name="SearchBox"
                                     Grid.Column="2"
                                     VerticalContentAlignment="Center"
                                     TextChanged="SearchBox_TextChanged"
                                     ToolTip="Szukaj (nazwa / typ)"/>
						</Grid>

						<!-- Dodaj -->
						<Border Background="Transparent"
                                BorderBrush="{DynamicResource Surface.Border}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="10"
                                Cursor="Hand"
                                MouseLeftButtonUp="AddBudget_Click"
                                Margin="0,0,0,10">
							<StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
								<TextBlock Text="+" FontSize="18" FontWeight="Bold"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Margin="0,0,8,0"/>
								<TextBlock Text="Dodaj budżet"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource App.Foreground}"/>
							</StackPanel>
						</Border>

						<!-- Header (4 kolumny) -->
						<Border Style="{StaticResource MiniTableHeaderBorder}">
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="150"/>
									<ColumnDefinition Width="140"/>
									<ColumnDefinition Width="220"/>
								</Grid.ColumnDefinitions>

								<TextBlock Grid.Column="0" Text="Nazwa" Style="{StaticResource MiniTableHeaderText}"/>
								<TextBlock Grid.Column="1" Text="Limit" Style="{StaticResource MiniTableHeaderText}" HorizontalAlignment="Right"/>
								<TextBlock Grid.Column="2" Text="Typ" Style="{StaticResource MiniTableHeaderText}"/>
								<TextBlock Grid.Column="3" Text="Okres" Style="{StaticResource MiniTableHeaderText}"/>
							</Grid>
						</Border>

						<!-- Lista (4 kolumny) -->
						<ListBox x:Name="BudgetsList"
                                 ItemContainerStyle="{StaticResource BudgetListItemStyle}"
                                 SelectionChanged="BudgetsList_SelectionChanged"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto">

							<ListBox.ItemTemplate>
								<DataTemplate>
									<Grid MinHeight="28" Margin="2,2">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*"/>
											<ColumnDefinition Width="150"/>
											<ColumnDefinition Width="140"/>
											<ColumnDefinition Width="220"/>
										</Grid.ColumnDefinitions>

										<TextBlock Grid.Column="0" Text="{Binding Name}" Style="{StaticResource MiniTableCellText}"/>
										<TextBlock Grid.Column="1" Text="{Binding PlannedAmount, StringFormat={}{0:N2} zł}" Style="{StaticResource AmountPlanned}"/>
										<TextBlock Grid.Column="2" Text="{Binding TypeDisplay}" Style="{StaticResource MiniTableCellText}"/>
										<TextBlock Grid.Column="3" Text="{Binding Period}" Style="{StaticResource MiniTableCellText}"/>
									</Grid>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>

						<!-- TU W KOLEJNYM KROKU wstawimy tabelę transakcji pod listą (wymaga danych) -->

					</StackPanel>
				</Border>

				<!-- PRAWA -->
				<StackPanel Grid.Column="1" Margin="8,0,0,0">

					<!-- Budżet (pomarańczowa ramka) -->
					<Border Style="{StaticResource OrangeCard}" Margin="0,0,0,10">
						<StackPanel>
							<TextBlock x:Name="BudgetNameText"
                                       Text="(wybierz budżet)"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource App.Foreground}"/>

							<TextBlock x:Name="BudgetMetaText"
                                       Foreground="{DynamicResource App.Foreground}"
                                       Opacity="0.85"
                                       Margin="0,2,0,10"/>

							<!-- Tylko Limit (zaplanowano) -->
							<StackPanel>
								<TextBlock Text="Limit (maksymalnie do wydania)"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Opacity="0.85"/>
								<TextBlock x:Name="BudgetPlannedText"
                                           Foreground="{DynamicResource Brand.Blue}"
                                           FontWeight="Bold"
                                           FontSize="16"/>
							</StackPanel>
						</StackPanel>
					</Border>

					<!-- Historia (pomarańczowa ramka + ciemny wykres) -->
					<Border Style="{StaticResource OrangeCard}" Margin="0,0,0,10">
						<StackPanel>
							<TextBlock Text="Historia budżetu" Style="{StaticResource CardHeader}" Margin="0,0,0,8"/>
							<lvc:CartesianChart x:Name="BudgetHistoryChartControl"
                                                Height="220"
                                                Background="{DynamicResource Surface.Background}"/>
						</StackPanel>
					</Border>

					<!-- Analiza (pomarańczowa ramka) -->
					<Border Style="{StaticResource OrangeCard}">
						<StackPanel>
							<TextBlock Text="Analiza budżetu" Style="{StaticResource CardHeader}" Margin="0,0,0,8"/>
							<ItemsControl x:Name="BudgetInsightsList"/>
						</StackPanel>
					</Border>

				</StackPanel>

			</Grid>
		</Grid>
	</ScrollViewer>
</UserControl>
