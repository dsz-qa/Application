<UserControl x:Class="Finly.Pages.BudgetsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:Finly.Views.Controls">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
            <!-- Budget card template -->
            <DataTemplate x:Key="BudgetItemTemplate">
                <Border BorderBrush="{DynamicResource Brand.Blue}" BorderThickness="2" CornerRadius="10" Padding="12" Margin="0,0,0,12" Background="{DynamicResource Surface.Background}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- Header: category name -->
                        <TextBlock Grid.Row="0" Grid.Column="0" FontWeight="Bold" FontSize="14" Foreground="{DynamicResource App.Foreground}">
                            <TextBlock.Text>
                                <PriorityBinding>
                                    <Binding Path="CategoryName"/>
                                    <Binding Path="Name"/>
                                </PriorityBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        <!-- action buttons -->
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Style="{StaticResource TitleBarIconButton}" ToolTip="Edytuj" Margin="0,0,6,0">
                                <Image Source="/Assets/Images/edit.png" Width="20" Height="20" Stretch="Uniform"/>
                            </Button>
                            <Button Style="{StaticResource TitleBarIconButton}" ToolTip="Usuń">
                                <Image Source="/Assets/Images/delete.png" Width="20" Height="20" Stretch="Uniform"/>
                            </Button>
                        </StackPanel>
                        <!-- row: limit/spent/remaining -->
                        <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,6,0,6">
                            <TextBlock Text="{Binding Limit, StringFormat=Limit: {0} zł}" Foreground="{DynamicResource App.Foreground}"/>
                            <TextBlock Text="{Binding Spent, StringFormat= • Wydano: {0} zł}" Foreground="{DynamicResource App.Foreground}" Margin="8,0,0,0"/>
                            <TextBlock Text="{Binding Remaining, StringFormat= • Pozostało: {0} zł}" Foreground="{DynamicResource App.Foreground}" Margin="8,0,0,0"/>
                        </StackPanel>
                        <!-- progress bar -->
                        <ProgressBar Grid.Row="2" Grid.ColumnSpan="2" Height="16" Minimum="0" Value="{Binding Spent}" Maximum="{Binding Limit}" Margin="0,0,0,0"/>
                    </Grid>
                </Border>
            </DataTemplate>
        </Grid.Resources>

        <!-- Header -->
        <TextBlock Text="Budżety" FontSize="18" FontWeight="Bold"/>

        <!-- Top add tile -->
        <Border Grid.Row="1" BorderBrush="{DynamicResource Brand.Blue}" BorderThickness="2" CornerRadius="10" Padding="16" Background="Transparent" Margin="0,12,0,12">
            <Button Content="Dodaj budżet" Style="{StaticResource PrimaryButton}" HorizontalAlignment="Stretch" Padding="16" Command="{Binding ToggleAddPanelCommand}"/>
        </Border>

        <!-- Main content: add panel + sections -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Orientation="Vertical">
                <!-- Collapsible add panel -->
                <Border BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Background="{DynamicResource Surface.Background}" Margin="0,0,0,12" Visibility="{Binding IsAddPanelVisible, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="Dodaj nowy budżet" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}"/>

                        <!-- Sekcja1: wybór rodzaju budżetu -->
                        <StackPanel Orientation="Vertical" Margin="0,8,0,0">
                            <TextBlock Text="Rodzaj budżetu" FontWeight="SemiBold"/>
                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                <RadioButton x:Name="TypeMonthlyRadio" Content="Miesięczny" GroupName="BudgetType" Margin="0,0,8,0"/>
                                <RadioButton x:Name="TypeWeeklyRadio" Content="Tygodniowy" GroupName="BudgetType" Margin="0,0,8,0"/>
                                <RadioButton x:Name="TypeQuarterlyRadio" Content="Kwartalny" GroupName="BudgetType" Margin="0,0,8,0"/>
                                <RadioButton x:Name="TypeYearlyRadio" Content="Roczny" GroupName="BudgetType"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Sekcja2: wybór kategorii -->
                        <StackPanel Orientation="Vertical" Margin="0,12,0,0">
                            <TextBlock Text="Kategoria" FontWeight="SemiBold"/>
                            <ComboBox x:Name="FormCategoryBox" Width="240" IsEditable="True" Margin="0,6,0,0"/>
                        </StackPanel>

                        <!-- Sekcja3: szczegóły -->
                        <StackPanel Orientation="Vertical" Margin="0,12,0,0">
                            <TextBlock Text="Szczegóły" FontWeight="SemiBold"/>
                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                <TextBox x:Name="FormAmountBox" Width="120"/>
                                <CheckBox x:Name="RepeatCheck" Content="Powtarzaj w kolejnych okresach" Margin="12,0,0,0"/>
                                <CheckBox x:Name="RolloverCheck" Content="Przenoś niewykorzystane środki" Margin="12,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Przyciski na dole -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                            <Button x:Name="CancelFormBtn" Content="Anuluj" Margin="0,0,8,0" Click="CancelFormBtn_Click"/>
                            <Button x:Name="SaveBudgetBtn" Content="Zapisz budżet" Style="{StaticResource PrimaryButton}" Click="SaveBudgetBtn_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Sections -->
                <TextBlock Text="Budżety miesięczne" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}" Margin="0,0,0,8"/>
                <ItemsControl ItemTemplate="{StaticResource BudgetItemTemplate}" ItemsSource="{Binding BudgetsMonthly}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" ItemWidth="360"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <TextBlock Text="Budżety tygodniowe" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}" Margin="0,16,0,8"/>
                <ItemsControl ItemTemplate="{StaticResource BudgetItemTemplate}" ItemsSource="{Binding BudgetsWeekly}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" ItemWidth="360"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <TextBlock Text="Budżety kwartalne" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}" Margin="0,16,0,8"/>
                <ItemsControl ItemTemplate="{StaticResource BudgetItemTemplate}" ItemsSource="{Binding BudgetsQuarterly}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" ItemWidth="360"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <TextBlock Text="Budżety roczne" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}" Margin="0,16,0,8"/>
                <ItemsControl ItemTemplate="{StaticResource BudgetItemTemplate}" ItemsSource="{Binding BudgetsYearly}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" ItemWidth="360"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>