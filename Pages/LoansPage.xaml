<UserControl x:Class="Finly.Pages.LoansPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Finly.ViewModels"
             Background="{DynamicResource App.Background}">

	<UserControl.Resources>

		<!-- ===== LOCAL, SAFE STYLES (only for this page) ===== -->

		<!-- Card base -->
		<Style x:Key="LoansCard" TargetType="Border">
			<Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius" Value="10"/>
			<Setter Property="Padding" Value="12"/>
		</Style>

		<Style x:Key="LoansKpiCard" TargetType="Border" BasedOn="{StaticResource LoansCard}">
			<Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="BorderThickness" Value="2"/>
			<Setter Property="MinWidth" Value="260"/>
			<Setter Property="MaxWidth" Value="360"/>
			<Setter Property="Margin" Value="0,0,12,12"/>
		</Style>

		<Style x:Key="LoansKpiHeader" TargetType="TextBlock">
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Opacity" Value="0.85"/>
		</Style>

		<Style x:Key="LoansKpiValue" TargetType="TextBlock">
			<Setter Property="FontSize" Value="26"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Margin" Value="0,2,0,0"/>
		</Style>

		<!-- Financial Analysis card (match Dashboard look/feel) -->
		<Style x:Key="FinancialAnalysisCardBorderStyle" TargetType="Border" BasedOn="{StaticResource LoansCard}">
			<Setter Property="BorderBrush" Value="{DynamicResource Brand.Orange}"/>
			<Setter Property="BorderThickness" Value="2"/>
		</Style>

		<Style x:Key="FinancialAnalysisCardHeaderStyle" TargetType="TextBlock">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Opacity" Value="1"/>
		</Style>

		<!-- Small buttons baseline (only if you don't have global ones) -->
		<Style x:Key="LoansSmallButton" TargetType="Button">
			<Setter Property="Height" Value="30"/>
			<Setter Property="Padding" Value="12,0"/>
			<Setter Property="MinWidth" Value="120"/>
		</Style>

		<!-- Local small primary variant to preserve primary look but avoid text clipping -->
		<Style x:Key="LoansPrimarySmallButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
			<Setter Property="MinHeight" Value="30"/>
			<Setter Property="Padding" Value="12,4"/>
			<Setter Property="MinWidth" Value="120"/>
			<Setter Property="HorizontalContentAlignment" Value="Center"/>
			<Setter Property="VerticalContentAlignment" Value="Center"/>
			<!-- Ensure content wraps instead of being clipped -->
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<TextBlock Text="{Binding}" TextWrapping="Wrap" TextAlignment="Center"/>
					</DataTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- No-wrap variant so text stays on one line; wider min width to fit full text -->
		<Style x:Key="LoansPrimarySmallButtonNoWrap" TargetType="Button" BasedOn="{StaticResource LoansPrimarySmallButton}">
			<Setter Property="MinWidth" Value="150"/>
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<TextBlock Text="{Binding}" TextWrapping="NoWrap" TextAlignment="Center"/>
					</DataTemplate>
				</Setter.Value>
			</Setter>
		</Style>

	</UserControl.Resources>

	<ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="0"
                  Background="Transparent">

		<StackPanel Margin="16">

			<!-- ===== Header ===== -->
			<StackPanel Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="0,0,0,12">
				<TextBlock Text="Kredyty"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="{DynamicResource App.Foreground}"/>
			</StackPanel>

			<!-- ===== KPI + Analizy finansowe ===== -->
			<Grid Margin="0,0,0,12">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" MinWidth="320" />
				</Grid.ColumnDefinitions>

				<!-- KPI (left) -->
				<WrapPanel Grid.Column="0"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           Margin="0,0,12,0">

					<Border Style="{StaticResource LoansKpiCard}">
						<StackPanel>
							<TextBlock Text="Całkowita kwota wszystkich kredytów"
                                       Style="{StaticResource LoansKpiHeader}"/>
							<TextBlock x:Name="TotalLoansTileAmount"
                                       Text="0,00 zł"
                                       Style="{StaticResource LoansKpiValue}"/>
						</StackPanel>
					</Border>

					<Border Style="{StaticResource LoansKpiCard}">
						<StackPanel>
							<TextBlock Text="Miesięczny koszt rat kredytów"
                                       Style="{StaticResource LoansKpiHeader}"/>
							<TextBlock x:Name="MonthlyLoansTileAmount"
                                       Text="0,00 zł"
                                       Style="{StaticResource LoansKpiValue}"/>
						</StackPanel>
					</Border>

					<!-- Add loan tile -->
					<Border Margin="0,0,12,12"
                            Padding="18"
                            Background="{DynamicResource Surface.Background}"
                            BorderBrush="{DynamicResource Surface.Border}"
                            BorderThickness="1"
                            CornerRadius="10"
                            Cursor="Hand"
                            MinWidth="260"
                            MaxWidth="360"
                            MouseDown="AddLoanCard_Click">
						<StackPanel HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
							<TextBlock Text="➕"
                                       FontSize="22"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource App.Foreground}"/>
							<TextBlock Text="Dodaj kredyt"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource App.Foreground}"/>
						</StackPanel>
					</Border>

				</WrapPanel>

				<!-- Analizy finansowe (right) -->
				<Border Grid.Column="1"
                        Style="{StaticResource FinancialAnalysisCardBorderStyle}"
                        HorizontalAlignment="Right"
                        MinWidth="320"
                        MaxWidth="420"
                        Margin="0,0,0,12">
					<StackPanel>

						<TextBlock Text="Analizy finansowe"
                                   Style="{StaticResource FinancialAnalysisCardHeaderStyle}"
                                   Margin="0,0,0,10"/>

						<!-- EXACTLY like Dashboard: list of lines -->
						<ItemsControl x:Name="InsightsList">
							<ItemsControl.ItemTemplate>
								<DataTemplate DataType="{x:Type vm:LoanInsightVm}">
									<TextBlock Foreground="{DynamicResource App.Foreground}"
                                               Margin="0,2,0,2"
                                               TextWrapping="Wrap">
										<Run Text="{Binding Label}"/>
										<Run Text=": "/>
										<Run Text="{Binding Value}" FontWeight="Bold"/>
									</TextBlock>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>

					</StackPanel>
				</Border>
			</Grid>

			<!-- ===== Loan Cards ===== -->
			<ItemsControl x:Name="LoansGrid">

				<ItemsControl.Resources>

					<!-- Single loan card -->
					<DataTemplate DataType="{x:Type vm:LoanCardVm}">
						<Border Margin="0,0,12,12"
                                Background="{DynamicResource Surface.Background}"
                                BorderBrush="{DynamicResource Surface.Border}"
                                BorderThickness="1"
                                CornerRadius="10"
                                Padding="12"
                                MinWidth="420"
                                MaxWidth="420">

							<Grid>
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="Auto"/>
								</Grid.RowDefinitions>

								<!-- Header -->
								<StackPanel Grid.Row="0"
                                            Orientation="Horizontal"
                                            VerticalAlignment="Center">
									<TextBlock Text="🏠"
                                               FontSize="32"
                                               Margin="0,0,8,0"
                                               VerticalAlignment="Center"/>
									<TextBlock Text="{Binding Name}"
                                               FontWeight="Bold"
                                               Foreground="{DynamicResource App.Foreground}"
                                               VerticalAlignment="Center"/>
								</StackPanel>

								<!-- Middle -->
								<StackPanel Grid.Row="1" Margin="0,8,0,8">
									<TextBlock Text="Pozostało:"
                                               Foreground="Gray"
                                               FontSize="12"/>
									<TextBlock Text="{Binding PrincipalStr}"
                                               FontSize="20"
                                               FontWeight="Bold"
                                               Foreground="OrangeRed"/>

									<StackPanel Orientation="Horizontal"
                                                Margin="0,6,0,0"
                                                HorizontalAlignment="Left">
										<TextBlock Text="Oprocentowanie:"
                                                   Foreground="Gray"
                                                   FontSize="11"
                                                   Margin="0,0,6,0"/>
										<TextBlock Text="{Binding InterestRate, StringFormat={}{0}%}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource App.Foreground}"
                                                   Margin="0,0,12,0"/>
										<TextBlock Text="Kolejna rata:"
                                                   Foreground="Gray"
                                                   FontSize="11"
                                                   Margin="0,0,6,0"/>
										<TextBlock Text="{Binding NextPaymentInfo}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource App.Foreground}"/>
									</StackPanel>

									<ProgressBar Value="{Binding PercentPaidClamped, Mode=OneWay}"
                                                 Maximum="100"
                                                 Height="12"
                                                 Margin="0,8,0,0"/>

									<Grid Margin="0,8,0,0">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*" />
											<ColumnDefinition Width="*" />
										</Grid.ColumnDefinitions>

										<StackPanel Grid.Column="0">
											<TextBlock Text="Następna rata:"
                                                       Foreground="Gray"
                                                       FontSize="11"/>
											<TextBlock Text="{Binding NextPayment}"
                                                       FontSize="12"
                                                       Foreground="{DynamicResource App.Foreground}"/>
										</StackPanel>

										<StackPanel Grid.Column="1">
											<TextBlock Text="Do końca:"
                                                       Foreground="Gray"
                                                       FontSize="11"/>
											<TextBlock Text="{Binding RemainingTermStr}"
                                                       FontSize="12"
                                                       Foreground="{DynamicResource App.Foreground}"/>
										</StackPanel>
									</Grid>
								</StackPanel>

								<!-- Bottom: actions (clean layout) -->
								<Grid Grid.Row="2" Margin="0,6,0,0">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*" />
										<ColumnDefinition Width="Auto" />
									</Grid.ColumnDefinitions>

									<!-- LEFT -->
									<StackPanel Grid.Column="0">

										<!-- main actions -->
										<UniformGrid Columns="2" Margin="0,0,0,8">
											<Button Content="Symulacja nadpłaty"
                                                    Style="{StaticResource LoansPrimarySmallButton}"
                                                    Click="ShowSimPanel_Click"
                                                    Tag="{Binding}"/>
										</UniformGrid>

										<!-- icon actions -->
										<StackPanel Orientation="Horizontal">

											<!-- If you already have EditIconButton/DeleteIconButton globally, they will be used -->
											<Button Width="36" Height="36"
                                                    Margin="0,0,8,0"
                                                    Click="EditLoan_Click"
                                                    Tag="{Binding}"
                                                    ToolTip="Edytuj kredyt"
                                                    Style="{StaticResource EditIconButton}"/>

											<Button Width="36" Height="36"
                                                    Click="DeleteLoan_Click"
                                                    Tag="{Binding}"
                                                    ToolTip="Usuń kredyt"
                                                    Style="{StaticResource DeleteIconButton}"/>

							<!-- Nadpłać button moved next to Delete; no-wrap variant to keep text on one line -->
							<Button Content="Nadpłać kredyt"
								Style="{StaticResource LoansPrimarySmallButtonNoWrap}"
								Margin="8,0,0,0"
								Click="CardAddPayment_Click"
								Tag="{Binding}"/>

										</StackPanel>

										<!-- delete confirm under the buttons -->
										<Border x:Name="DeleteConfirmPanel"
                                                Background="Transparent"
                                                Visibility="Collapsed"
                                                Margin="0,8,0,0">
											<StackPanel>
												<TextBlock Text="Czy na pewno chcesz usunąć ten kredyt?"
                                                           Foreground="OrangeRed"
                                                           FontWeight="Bold"
                                                           Margin="0,0,0,6"/>
												<StackPanel Orientation="Horizontal">
													<Button Content="Tak"
                                                            Width="80"
                                                            Margin="0,0,8,0"
                                                            Click="ConfirmDeleteLoan_Click"
                                                            Tag="{Binding}"/>
													<Button Content="Nie"
                                                            Width="80"
                                                            Click="DeleteCancel_Click"/>
												</StackPanel>
											</StackPanel>
										</Border>

									</StackPanel>

									<!-- RIGHT -->
									<StackPanel Grid.Column="1"
                                                Margin="12,0,0,0"
                                                VerticalAlignment="Top"
                                                MinWidth="170">

										<Button Height="30"
                                                Padding="12,0"
                                                Margin="0,0,0,8"
                                                Click="CardAttachSchedule_Click"
                                                Tag="{Binding}"
                                                ToolTip="Załącz harmonogram spłat rat kredytu">
											<StackPanel Orientation="Horizontal">
												<TextBlock Text="Załącz harmonogram"/>
											</StackPanel>
										</Button>

										<Button Height="30"
                                                Padding="12,0"
                                                Click="CardSchedule_Click"
                                                Tag="{Binding}"
                                                ToolTip="Harmonogram spłat rat kredytu">
											<TextBlock Text="Harmonogram spłat"/>
										</Button>

									</StackPanel>
								</Grid>

							</Grid>
						</Border>
					</DataTemplate>

					<!-- Add loan tile (optional, if you still use it in the list) -->
					<DataTemplate DataType="{x:Type vm:AddLoanTile}">
						<Border Margin="0,0,12,12"
                                Padding="24"
                                Background="{DynamicResource Surface.Background}"
                                BorderBrush="{DynamicResource Surface.Border}"
                                BorderThickness="1"
                                CornerRadius="10"
                                Cursor="Hand"
                                MinWidth="360"
                                MaxWidth="720"
                                MouseDown="AddLoanCard_Click">
							<StackPanel HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
								<TextBlock Text="➕"
                                           FontSize="24"
                                           HorizontalAlignment="Center"
                                           Foreground="{DynamicResource App.Foreground}"/>
								<TextBlock Text="Dodaj kredyt"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center"
                                           Foreground="{DynamicResource App.Foreground}"/>
							</StackPanel>
						</Border>
					</DataTemplate>

				</ItemsControl.Resources>

				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<WrapPanel IsItemsHost="True"
                                   ItemWidth="440"
                                   ItemHeight="Auto"/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
			</ItemsControl>

			<!-- ===== Bottom panel (forms) ===== -->
			<Border x:Name="FormBorder"
                    Background="{DynamicResource Surface.Background}"
                    BorderBrush="{DynamicResource Surface.Border}"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="12"
                    Margin="0,12,0,0"
                    Visibility="Collapsed">

				<Grid>

					<!-- Add/Edit -->
					<StackPanel x:Name="AddEditPanel" Visibility="Collapsed">

						<TextBlock x:Name="AddEditHeaderText"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Margin="0,0,0,8"
                                   Text="Dodaj kredyt"/>

						<TextBlock x:Name="LoanFormMessage"
                                   Foreground="OrangeRed"
                                   Margin="0,0,0,8"/>

						<TextBlock Text="Nazwa kredytu:" Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="LoanNameBox"/>

						<StackPanel Orientation="Horizontal" Margin="0,8,0,0">
							<StackPanel Width="160">
								<TextBlock Text="Kwota:" Foreground="{DynamicResource App.Foreground}"/>
								<TextBox x:Name="LoanPrincipalBox"
                                         TextChanged="LoanFormField_Changed"/>
							</StackPanel>

							<StackPanel Width="140" Margin="8,0,0,0">
								<TextBlock Text="Oprocentowanie (%):" Foreground="{DynamicResource App.Foreground}"/>
								<TextBox x:Name="LoanInterestBox"
                                         TextChanged="LoanFormField_Changed"/>
							</StackPanel>

							<StackPanel Width="140" Margin="8,0,0,0">
								<TextBlock Text="Okres (mies.):" Foreground="{DynamicResource App.Foreground}"/>
								<TextBox x:Name="LoanTermBox"
                                         TextChanged="LoanFormField_Changed"/>
							</StackPanel>
						</StackPanel>

						<StackPanel Orientation="Horizontal" Margin="0,8,0,0">
							<StackPanel Width="260">
								<TextBlock Text="Konto, z którego spłacasz kredyt:"
                                           FontSize="12"
                                           Foreground="Gray"/>
								<ComboBox x:Name="LoanAccountBox"
                                          Width="240"
                                          DisplayMemberPath="AccountName"
                                          SelectedValuePath="Id"/>
							</StackPanel>
						</StackPanel>

						<StackPanel Orientation="Horizontal" Margin="0,8,0,0">
							<StackPanel Width="220">
								<TextBlock Text="Data rozpoczęcia kredytu:"
                                           FontSize="12"
                                           Foreground="Gray"/>
								<DatePicker x:Name="LoanStartDatePicker"/>
							</StackPanel>

							<StackPanel Width="200" Margin="12,0,0,0">
								<TextBlock Text="Liczba spłaconych rat:"
                                           FontSize="12"
                                           Foreground="Gray"/>
								<TextBox x:Name="PaidInstallmentsBox"/>
							</StackPanel>
						</StackPanel>

						<WrapPanel Margin="0,8,0,0">
							<StackPanel Width="220" Margin="0,0,12,8">
								<TextBlock Text="Miesięczna rata (szac.):"
                                           Foreground="Gray"
                                           FontSize="12"/>
								<TextBlock x:Name="MonthlyPaymentText"
                                           Text="0,00 zł"
                                           Foreground="{DynamicResource App.Foreground}"
                                           FontWeight="Bold"/>
							</StackPanel>

							<StackPanel Width="240" Margin="0,0,12,8">
								<TextBlock Text="Część kapitałowa (pierwsza rata):"
                                           Foreground="Gray"
                                           FontSize="12"/>
								<TextBlock x:Name="FirstPrincipalText"
                                           Text="0,00 zł"
                                           Foreground="{DynamicResource App.Foreground}"/>
							</StackPanel>

							<StackPanel Width="240" Margin="0,0,12,8">
								<TextBlock Text="Część odsetkowa (pierwsza rata):"
                                           Foreground="Gray"
                                           FontSize="12"/>
								<TextBlock x:Name="FirstInterestText"
                                           Text="0,00 zł"
                                           Foreground="{DynamicResource App.Foreground}"/>
							</StackPanel>

							<StackPanel Width="260" Margin="0,0,12,8">
								<TextBlock Text="Dzień pobrania raty kredytu:"
                                           Foreground="Gray"
                                           FontSize="12"/>
								<ComboBox x:Name="LoanPaymentDayBox" Width="160">
									<ComboBoxItem Tag="0">Nie ustawiono</ComboBoxItem>
									<ComboBoxItem Tag="1">1</ComboBoxItem>
									<ComboBoxItem Tag="2">2</ComboBoxItem>
									<ComboBoxItem Tag="3">3</ComboBoxItem>
									<ComboBoxItem Tag="4">4</ComboBoxItem>
									<ComboBoxItem Tag="5">5</ComboBoxItem>
									<ComboBoxItem Tag="6">6</ComboBoxItem>
									<ComboBoxItem Tag="7">7</ComboBoxItem>
									<ComboBoxItem Tag="8">8</ComboBoxItem>
									<ComboBoxItem Tag="9">9</ComboBoxItem>
									<ComboBoxItem Tag="10">10</ComboBoxItem>
									<ComboBoxItem Tag="11">11</ComboBoxItem>
									<ComboBoxItem Tag="12">12</ComboBoxItem>
									<ComboBoxItem Tag="13">13</ComboBoxItem>
									<ComboBoxItem Tag="14">14</ComboBoxItem>
									<ComboBoxItem Tag="15">15</ComboBoxItem>
									<ComboBoxItem Tag="16">16</ComboBoxItem>
									<ComboBoxItem Tag="17">17</ComboBoxItem>
									<ComboBoxItem Tag="18">18</ComboBoxItem>
									<ComboBoxItem Tag="19">19</ComboBoxItem>
									<ComboBoxItem Tag="20">20</ComboBoxItem>
									<ComboBoxItem Tag="21">21</ComboBoxItem>
									<ComboBoxItem Tag="22">22</ComboBoxItem>
									<ComboBoxItem Tag="23">23</ComboBoxItem>
									<ComboBoxItem Tag="24">24</ComboBoxItem>
									<ComboBoxItem Tag="25">25</ComboBoxItem>
									<ComboBoxItem Tag="26">26</ComboBoxItem>
									<ComboBoxItem Tag="27">27</ComboBoxItem>
									<ComboBoxItem Tag="28">28</ComboBoxItem>
									<ComboBoxItem Tag="29">29</ComboBoxItem>
									<ComboBoxItem Tag="30">30</ComboBoxItem>
									<ComboBoxItem Tag="31">31</ComboBoxItem>
								</ComboBox>
							</StackPanel>
						</WrapPanel>

						<StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Left"
                                    Margin="0,8,0,0">
							<Button Content="Załącz harmonogram spłat z Twojego banku."
                                    Click="ChooseSchedule_Click"/>
							<TextBlock x:Name="ScheduleFileNameText"
                                       Text="Brak pliku"
                                       Margin="12,4,0,0"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource App.Foreground}"/>
						</StackPanel>

						<StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,8,0,0">
							<Button x:Name="SaveLoanBtn"
                                    Content="Zapisz"
                                    Width="90"
                                    Margin="8,0,0,0"
                                    Click="SaveLoan_Click"/>
							<Button Content="Anuluj"
                                    Width="90"
                                    Margin="8,0,0,0"
                                    Click="CancelLoan_Click"/>
						</StackPanel>
					</StackPanel>

					<!-- Schedule panel -->
					<StackPanel x:Name="SchedulePanel" Visibility="Collapsed">
						<TextBlock Text="Harmonogram spłat"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Margin="0,0,0,8"/>
						<ItemsControl x:Name="ScheduleList">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding}"
                                               Foreground="{DynamicResource App.Foreground}"/>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
						<StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,8,0,0">
							<Button Content="Zamknij"
                                    Width="90"
                                    Click="CancelLoan_Click"/>
						</StackPanel>
					</StackPanel>

					<!-- Overpay panel -->
					<StackPanel x:Name="OverpayPanel" Visibility="Collapsed">
						<TextBlock Text="Nadpłata kredytu"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Margin="0,0,0,4"/>
						<TextBlock Text="Wprowadź kwotę nadpłaty:"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="OverpayAmountBox"/>
						<StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,8,0,0">
							<Button x:Name="OverpaySaveBtn"
                                    Content="Zatwierdź nadpłatę"
                                    Width="160"
                                    Click="OverpaySave_Click"/>
							<Button Content="Anuluj"
                                    Width="90"
                                    Margin="8,0,0,0"
                                    Click="CancelLoan_Click"/>
						</StackPanel>
						<TextBlock x:Name="OverpayResult"
                                   Foreground="Green"
                                   Margin="0,8,0,0"/>
					</StackPanel>

					<!-- Simulation panel -->
					<StackPanel x:Name="SimPanel" Visibility="Collapsed">
						<TextBlock Text="Symulacja zadłużenia po nadpłacie kredytu"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Margin="0,0,0,4"/>
						<TextBlock Text="Podaj dodatkową wpłatę (jednorazowo):"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="SimExtraBox"/>
						<StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,8,0,0">
							<Button Content="Symuluj"
                                    Width="120"
                                    Click="SimulateInline_Click"/>
							<Button Content="Zamknij"
                                    Width="90"
                                    Margin="8,0,0,0"
                                    Click="CancelLoan_Click"/>
						</StackPanel>
						<TextBlock x:Name="SimResult"
                                   Foreground="{DynamicResource App.Foreground}"
                                   Margin="0,8,0,0"/>
					</StackPanel>

				</Grid>
			</Border>

		</StackPanel>
	</ScrollViewer>
</UserControl>
