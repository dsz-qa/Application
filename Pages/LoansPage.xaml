<UserControl x:Class="Finly.Pages.LoansPage"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:local="clr-namespace:Finly.Pages">
	<Grid Margin="16">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="200"/>
		</Grid.RowDefinitions>

		<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
			<TextBlock Text="Kredyty" FontSize="20" FontWeight="Bold"
 Foreground="{DynamicResource App.Foreground}"/>

			<Button Content="Dodaj kredyt" Margin="12,0,0,0" Padding="8,4" Click="ShowAddLoan_Click"/>
		</StackPanel>

		<!-- inline form (hidden by default) -->
		<Border x:Name="FormBorder" Grid.Row="0" Grid.RowSpan="4" Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Visibility="Collapsed" HorizontalAlignment="Center" Width="520">
			<StackPanel>
				<TextBlock x:Name="FormHeader" Text="Dodaj kredyt" FontWeight="Bold" FontSize="16" Margin="0,0,0,8"/>
				<TextBlock x:Name="LoanFormMessage" Foreground="OrangeRed" Margin="0,0,0,8"/>

				<StackPanel Orientation="Vertical" Margin="0,0,0,8">
					<TextBlock Text="Nazwa kredytu:"/>
					<TextBox x:Name="LoanNameBox" />
				</StackPanel>

				<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
					<StackPanel Width="160">
						<TextBlock Text="Kwota:"/>
						<TextBox x:Name="LoanPrincipalBox" />
					</StackPanel>
					<StackPanel Width="120" Margin="8,0,0,0">
						<TextBlock Text="Oprocentowanie (%):"/>
						<TextBox x:Name="LoanInterestBox" />
					</StackPanel>
					<StackPanel Width="120" Margin="8,0,0,0">
						<TextBlock Text="Okres (mies.):"/>
						<TextBox x:Name="LoanTermBox" />
					</StackPanel>
				</StackPanel>

				<StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
					<DatePicker x:Name="LoanStartDatePicker" SelectedDate="{x:Static sys:DateTime.Today}" xmlns:sys="clr-namespace:System;assembly=mscorlib"/>
					<Button Content="OK" Width="80" Margin="8,0,0,0" Click="SaveLoan_Click"/>
					<Button Content="Anuluj" Width="80" Margin="8,0,0,0" Click="CancelLoan_Click"/>
				</StackPanel>
			</StackPanel>
		</Border>

		<!-- KPI Bar -->
		<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,12,0,0" HorizontalAlignment="Stretch" Height="96">
			<Border Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,12,0" Width="250">
				<StackPanel>
					<TextBlock Text="Łączne zadłużenie" Foreground="Gray" FontSize="12"/>
					<TextBlock Name="TotalDebtText" Text="0 zł" FontSize="18" FontWeight="Bold" Foreground="OrangeRed"/>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,12,0" Width="250">
				<StackPanel>
					<TextBlock Text="Raty w tym miesiącu" Foreground="Gray" FontSize="12"/>
					<TextBlock Name="MonthlyPaymentText" Text="0 zł" FontSize="18" FontWeight="Bold" Foreground="OrangeRed"/>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,12,0" Width="300">
				<StackPanel>
					<TextBlock Text="Średnia rata (12M)" Foreground="Gray" FontSize="12"/>
					<TextBlock Name="AvgMonthlyText" Text="0 zł" FontSize="18" FontWeight="Bold" Foreground="OrangeRed"/>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,12,0" Width="220">
				<StackPanel>
					<TextBlock Text="% spłaconych kredytów" Foreground="Gray" FontSize="12"/>
					<TextBlock Name="PercentPaidText" Text="0%" FontSize="18" FontWeight="Bold" Foreground="OrangeRed"/>
				</StackPanel>
			</Border>
		</StackPanel>

		<!-- Loans grid -->
		<ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,12,0,0">
			<ItemsControl Name="LoansGrid">
				<ItemsControl.Resources>
					<!-- Loan card template -->
					<DataTemplate DataType="{x:Type local:LoanCardVm}">
						<Border Margin="8" Padding="12" Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8">
							<Grid>
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="*"/>
									<RowDefinition Height="Auto"/>
								</Grid.RowDefinitions>

								<StackPanel Orientation="Horizontal">
									<TextBlock Text="🏠" FontSize="16" Margin="0,0,6,0"/>
									<TextBlock Text="{Binding Name}" FontWeight="Bold"/>
								</StackPanel>

								<StackPanel Grid.Row="1" Margin="0,8,0,8">
									<TextBlock Text="Pozostało:" Foreground="Gray" FontSize="12"/>
									<TextBlock Text="{Binding PrincipalStr}" FontSize="20" FontWeight="Bold" Foreground="OrangeRed"/>

									<ProgressBar Value="{Binding PercentPaidClamped, Mode=OneWay}" Maximum="100" Height="12" Margin="0,8,0,0"/>

									<Grid Margin="0,8,0,0">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*" />
											<ColumnDefinition Width="*" />
										</Grid.ColumnDefinitions>
										<StackPanel Grid.Column="0">
											<TextBlock Text="Następna rata:" Foreground="Gray" FontSize="11"/>
											<TextBlock Text="{Binding NextPaymentInfo}" FontSize="12"/>
										</StackPanel>
										<StackPanel Grid.Column="1">
											<TextBlock Text="Do końca:" Foreground="Gray" FontSize="11"/>
											<TextBlock Text="{Binding RemainingTermStr}" FontSize="12"/>
										</StackPanel>
									</Grid>
								</StackPanel>

								<StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
									<Button Content="🔍" Width="36" Height="28" Margin="4,0,0,0" Click="CardDetails_Click" Tag="{Binding}"/>
									<Button Content="➕" Width="36" Height="28" Margin="4,0,0,0" Click="CardAddPayment_Click" Tag="{Binding}"/>
									<Button Content="📊" Width="36" Height="28" Margin="4,0,0,0" Click="CardSchedule_Click" Tag="{Binding}"/>
								</StackPanel>
							</Grid>
						</Border>
					</DataTemplate>

					<!-- Add tile template -->
					<DataTemplate DataType="{x:Type local:AddLoanTile}">
						<Border Margin="8" Padding="24" Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Cursor="Hand" MouseDown="AddLoanCard_Click">
							<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
								<TextBlock Text="➕" FontSize="24" HorizontalAlignment="Center"/>
								<TextBlock Text="Dodaj kredyt" FontWeight="SemiBold" HorizontalAlignment="Center"/>
							</StackPanel>
						</Border>
					</DataTemplate>
				</ItemsControl.Resources>
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<UniformGrid Columns="2" />
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
			</ItemsControl>
		</ScrollViewer>

		<!-- Bottom: timeline and insights -->
		<Grid Grid.Row="3" Margin="0,12,0,0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="320" />
			</Grid.ColumnDefinitions>

			<Border Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,12,0">
				<StackPanel>
					<TextBlock Text="Nadchodzące raty" FontWeight="Bold"/>
					<ItemsControl Name="UpcomingPaymentsList" Margin="0,8,0,0">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Padding="6" Margin="0,4,0,4" Background="Transparent">
									<StackPanel Orientation="Horizontal">
										<TextBlock Text="{Binding DateStr}" Width="90" Foreground="Gray"/>
										<TextBlock Text="{Binding LoanName}" Width="220"/>
										<TextBlock Text="{Binding AmountStr}" HorizontalAlignment="Right"/>
									</StackPanel>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
			</Border>

			<Border Grid.Column="1" Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="8" Padding="12">
				<StackPanel>
					<TextBlock Text="Smart-insighty" FontWeight="Bold"/>
					<ItemsControl Name="InsightsList" Margin="0,8,0,0" />
				</StackPanel>
			</Border>
		</Grid>

	</Grid>
</UserControl>

