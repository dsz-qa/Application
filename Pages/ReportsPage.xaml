<UserControl x:Class="Finly.Pages.ReportsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:Finly.Views.Controls"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:rp="clr-namespace:Finly.Views.Controls.ReportsPageControls"
             x:Name="Root"
             Background="{DynamicResource App.Background}"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True"
             TextOptions.TextFormattingMode="Display"
             TextOptions.TextRenderingMode="ClearType"
             Foreground="{DynamicResource App.Foreground}">

	<UserControl.Resources>

		<!-- ===================== MINI TABLE STYLES ===================== -->
		<Style x:Key="MiniTableCellText" TargetType="TextBlock">
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Margin" Value="6,2,6,2"/>
			<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
			<Setter Property="TextWrapping" Value="NoWrap"/>
		</Style>

		<Style x:Key="MiniTableHeaderBorder" TargetType="Border">
			<Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
			<Setter Property="Padding" Value="6,4"/>
			<Setter Property="Margin" Value="0,0,0,6"/>
			<Setter Property="CornerRadius" Value="6"/>
		</Style>

		<Style x:Key="MiniTableHeaderText" TargetType="TextBlock">
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Opacity" Value="0.85"/>
			<Setter Property="Margin" Value="6,0,6,0"/>
		</Style>

		<!-- ===================== CARDS ===================== -->
		<Style x:Key="Card" TargetType="Border">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius" Value="10"/>
			<Setter Property="Padding" Value="12"/>
		</Style>

		<Style x:Key="AccentCard" TargetType="Border" BasedOn="{StaticResource Card}">
			<Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="BorderThickness" Value="2"/>
		</Style>

		<Style x:Key="CardHeader" TargetType="TextBlock">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Opacity" Value="0.9"/>
			<Setter Property="TextWrapping" Value="Wrap"/>
		</Style>

		<!-- ===================== LIVECHARTS ===================== -->
		<Style x:Key="BaseCartesianChart" TargetType="{x:Type lvc:CartesianChart}">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="LegendPosition" Value="Hidden"/>
			<Setter Property="DrawMargin" Value="42,10,10,40"/>
			<Setter Property="AnimationsSpeed" Value="0:0:0.35"/>
			<Setter Property="ZoomMode" Value="None"/>
			<Setter Property="HorizontalAlignment" Value="Stretch"/>
			<Setter Property="VerticalAlignment" Value="Stretch"/>
		</Style>

		<!-- ===================== FILTRY (toggle) ===================== -->
		<Style x:Key="ModeFilterButton" TargetType="ToggleButton">
			<Setter Property="MinWidth" Value="150"/>
			<Setter Property="Height" Value="46"/>
			<Setter Property="Background" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="BorderThickness" Value="2"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Margin" Value="6,0,6,0"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ToggleButton">
						<Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="10,6">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="Bd" Property="Opacity" Value="0.95"/>
							</Trigger>
							<Trigger Property="IsChecked" Value="True">
								<Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource Separator.Orange}"/>
							</Trigger>
							<Trigger Property="IsEnabled" Value="False">
								<Setter TargetName="Bd" Property="Opacity" Value="0.55"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- ===================== Podium ===================== -->
		<Style x:Key="PodiumRank" TargetType="TextBlock">
			<Setter Property="FontSize" Value="18"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Opacity" Value="0.85"/>
			<Setter Property="Margin" Value="0,0,0,6"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>

		<Style x:Key="PodiumCategory" TargetType="TextBlock">
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="TextWrapping" Value="Wrap"/>
			<Setter Property="TextTrimming" Value="CharacterEllipsis"/>
			<Setter Property="Opacity" Value="0.95"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>

		<Style x:Key="PodiumAmount" TargetType="TextBlock">
			<Setter Property="FontSize" Value="15"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Margin" Value="0,8,0,0"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>

		<!-- ===================== Tabs (TabControl) ===================== -->

		<!-- TabControl: brak obcinania + prawy zapas -->
		<Style x:Key="ReportsTabControl" TargetType="TabControl">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
			<Setter Property="UseLayoutRounding" Value="True"/>
			<Setter Property="ClipToBounds" Value="False"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="TabControl">
						<Grid ClipToBounds="False">
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="*"/>
							</Grid.RowDefinitions>

							<!-- pasek zakładek (dajemy wewnętrzny prawy zapas, żeby ostatnia ramka nie była ucinana) -->
							<Border Grid.Row="0"
                                    Background="Transparent"
                                    ClipToBounds="False"
                                    Padding="0,0,18,0">
								<TabPanel x:Name="HeaderPanel"
                                          IsItemsHost="True"
                                          HorizontalAlignment="Center"
                                          Margin="0,0,0,10"
                                          ClipToBounds="False"/>
							</Border>

							<!-- treść -->
							<Border Grid.Row="1" Background="Transparent" ClipToBounds="False">
								<ContentPresenter ContentSource="SelectedContent"/>
							</Border>
						</Grid>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- TabItem: zawsze niebieskie, Selected = pomarańczowa ramka (nieucinana) -->
		<Style x:Key="ReportsTabItem" TargetType="TabItem">
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Background" Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="3"/>
			<Setter Property="Padding" Value="18,10"/>
			<Setter Property="Margin" Value="8,0,8,0"/>
			<Setter Property="Panel.ZIndex" Value="0"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
			<Setter Property="UseLayoutRounding" Value="True"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="TabItem">
						<!-- Outer = ramka; Inner = wypełnienie -->
						<Border x:Name="Outer"
                                Background="Transparent"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="2"
                                SnapsToDevicePixels="True">
							<Border x:Name="Inner"
                                    Background="{TemplateBinding Background}"
                                    Padding="{TemplateBinding Padding}">
								<ContentPresenter ContentSource="Header"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
							</Border>
						</Border>

						<ControlTemplate.Triggers>

							<Trigger Property="IsSelected" Value="True">
								<Setter Property="Panel.ZIndex" Value="10"/>
								<Setter TargetName="Outer" Property="BorderBrush" Value="{DynamicResource Separator.Orange}"/>
							</Trigger>

							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="Inner" Property="Opacity" Value="0.95"/>
							</Trigger>

							<Trigger Property="IsEnabled" Value="False">
								<Setter TargetName="Inner" Property="Opacity" Value="0.55"/>
							</Trigger>

						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

	</UserControl.Resources>

	<!-- ScrollViewer dla całej strony -->
	<ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  PanningMode="VerticalOnly"
                  ClipToBounds="False">

		<Grid Margin="8,0,8,12" ClipToBounds="False">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- ROW 0: KPI -->
			<Grid Grid.Row="0" Margin="0,0,0,12" ClipToBounds="False">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<!-- Obecny okres -->
				<Border Grid.Column="0" Style="{StaticResource AccentCard}" Margin="0,0,10,0">
					<StackPanel>
						<TextBlock Text="Obecny okres" Style="{StaticResource CardHeader}" FontSize="18" FontWeight="Bold"/>
						<TextBlock Text="{Binding PeriodLabel, FallbackValue=Brak danych, TargetNullValue=Brak danych}"
                                   Style="{StaticResource CardHeader}"
                                   Opacity="0.75"
                                   Margin="0,4,0,10"/>

						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
							</Grid.RowDefinitions>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<TextBlock Grid.Row="0" Grid.Column="0" Text="Wydatki:" FontWeight="SemiBold" Margin="0,0,10,6"/>
							<TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TotalExpensesStr}" FontSize="14" Opacity="0.9" Margin="0,0,0,6"/>

							<TextBlock Grid.Row="1" Grid.Column="0" Text="Przychody:" FontWeight="SemiBold" Margin="0,0,10,6"/>
							<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding TotalIncomesStr}" FontSize="14" Opacity="0.9" Margin="0,0,0,6"/>

							<TextBlock Grid.Row="2" Grid.Column="0" Text="Bilans:" FontWeight="SemiBold" Margin="0,0,10,0"/>
							<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding BalanceStr}" FontSize="14" Opacity="0.9"/>
						</Grid>
					</StackPanel>
				</Border>

				<!-- Poprzedni okres -->
				<Border Grid.Column="1" Style="{StaticResource AccentCard}" Margin="0,0,10,0">
					<StackPanel>
						<TextBlock Text="Poprzedni okres" Style="{StaticResource CardHeader}" FontSize="18" FontWeight="Bold"/>
						<TextBlock Text="{Binding PreviousPeriodLabel, FallbackValue=Brak danych, TargetNullValue=Brak danych}"
                                   Style="{StaticResource CardHeader}"
                                   Opacity="0.75"
                                   Margin="0,4,0,10"/>

						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
							</Grid.RowDefinitions>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<TextBlock Grid.Row="0" Grid.Column="0" Text="Wydatki:" FontWeight="SemiBold" Margin="0,0,10,6"/>
							<TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding PreviousTotalExpensesStr}" FontSize="14" Opacity="0.9" Margin="0,0,0,6"/>

							<TextBlock Grid.Row="1" Grid.Column="0" Text="Przychody:" FontWeight="SemiBold" Margin="0,0,10,6"/>
							<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding PreviousTotalIncomesStr}" FontSize="14" Opacity="0.9" Margin="0,0,0,6"/>

							<TextBlock Grid.Row="2" Grid.Column="0" Text="Bilans:" FontWeight="SemiBold" Margin="0,0,10,0"/>
							<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding PreviousBalanceStr}" FontSize="14" Opacity="0.9"/>
						</Grid>
					</StackPanel>
				</Border>

				<!-- Porównanie -->
				<Border Grid.Column="2" Style="{StaticResource AccentCard}">
					<StackPanel>
						<TextBlock Text="Porównanie okresów" Style="{StaticResource CardHeader}" FontSize="18" FontWeight="Bold"/>

						<TextBlock FontSize="14" Opacity="0.9" Margin="0,10,0,6" TextWrapping="Wrap">
							<Run Text="Wydatki: " FontWeight="Bold"/>
							<Run Text="{Binding CompareExpensesText, Mode=OneWay}"/>
						</TextBlock>

						<TextBlock FontSize="14" Opacity="0.9" Margin="0,0,0,6" TextWrapping="Wrap">
							<Run Text="Przychody: " FontWeight="Bold"/>
							<Run Text="{Binding CompareIncomesText, Mode=OneWay}"/>
						</TextBlock>

						<TextBlock FontSize="13" Opacity="0.85" TextWrapping="Wrap">
							<Run Text="Bilans: " FontWeight="Bold"/>
							<Run Text="{Binding CompareBalanceText, Mode=OneWay}"/>
						</TextBlock>
					</StackPanel>
				</Border>
			</Grid>

			<!-- ROW 1: PeriodBar -->
			<Border Grid.Row="1" Background="Transparent" Margin="0,0,0,8" ClipToBounds="False">
				<controls:PeriodBarControl x:Name="PeriodBar"
                                           HorizontalAlignment="Center"
                                           StartDate="{Binding FromDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                           EndDate="{Binding ToDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
			</Border>

			<!-- ROW 2: Export global -->
			<Border Grid.Row="2" Background="Transparent" Margin="0,0,0,12" ClipToBounds="False">
				<Button Content="Pobierz raport całościowy (PDF)"
                        Style="{DynamicResource PrimaryButton}"
                        HorizontalAlignment="Center"
                        FontSize="18"
                        FontWeight="Bold"
                        Padding="34,16"
                        MinWidth="420"
                        Click="ExportButton_Click"/>
			</Border>

			<!-- ROW 3: Tabs + treść -->
			<TabControl x:Name="ReportsTabs"
                        Grid.Row="3"
                        Style="{StaticResource ReportsTabControl}"
                        ItemContainerStyle="{StaticResource ReportsTabItem}"
                        SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}">

				<TabItem Header="Przegląd ogólny"/>
				<TabItem Header="Budżety"/>
				<TabItem Header="Kredyty"/>
				<TabItem Header="Cele"/>
				<TabItem Header="Inwestycje"/>
				<TabItem Header="Symulacja"/>

			</TabControl>

		</Grid>
	</ScrollViewer>
</UserControl>
