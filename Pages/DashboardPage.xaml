<UserControl x:Class="Finly.Pages.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- =========== LOKALNE STYLE =========== -->
    <UserControl.Resources>
        <!-- Karta/sekcja -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
            <Setter Property="BorderBrush"     Value="{DynamicResource Surface.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius"    Value="12"/>
            <Setter Property="Padding"         Value="12"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <!-- Tekst wyrównany do prawej (kwoty) -->
        <Style x:Key="RightAlignedCell" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="TextAlignment"       Value="Right"/>
        </Style>
    </UserControl.Resources>

    <!-- =========== GŁÓWNA SIATKA STRONY =========== -->
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- KPI -->
            <RowDefinition Height="Auto"/>
            <!-- Filtry -->
            <RowDefinition Height="*"/>
            <!-- Lista -->
            <RowDefinition Height="Auto"/>
            <!-- Dół -->
        </Grid.RowDefinitions>

        <!-- ===== KPI ===== -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="220"/>
            </Grid.ColumnDefinitions>

            <UniformGrid Rows="1" Margin="16" Columns="3">
                <Border Padding="12" CornerRadius="10" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Razem" FontWeight="SemiBold"/>
                        <TextBlock x:Name="DbTotal" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </Border>
                <Border Padding="12" CornerRadius="10" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="W kopertach" FontWeight="SemiBold"/>
                        <TextBlock x:Name="DbEnvelopes" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </Border>
                <Border Padding="12" CornerRadius="10" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Do rozdysponowania" FontWeight="SemiBold"/>
                        <TextBlock x:Name="DbAvail" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </Border>
            </UniformGrid>


            <GroupBox Header="Suma wydatków" Grid.Column="1" Margin="0,0,8,0">
                <TextBlock x:Name="TotalAmountText"
                           FontSize="20" FontWeight="SemiBold"
                           VerticalAlignment="Center" HorizontalAlignment="Left"
                           Text="0,00 zł"/>
            </GroupBox>

            <GroupBox Header="Liczba wpisów" Grid.Column="2" Margin="0,0,8,0">
                <TextBlock x:Name="EntryCountText"
                           FontSize="20" FontWeight="SemiBold"
                           VerticalAlignment="Center" HorizontalAlignment="Left"
                           Text="0"/>
            </GroupBox>

            <GroupBox Header="Średnia dzienna" Grid.Column="3">
                <TextBlock x:Name="DailyAverageText"
                           FontSize="20" FontWeight="SemiBold"
                           VerticalAlignment="Center" HorizontalAlignment="Left"
                           Text="0,00 zł"/>
            </GroupBox>
        </Grid>

        <!-- ===== FILTRY ===== -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
            <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal">

                    <!-- PRESET ZAKRESU -->
                    <ComboBox x:Name="PresetRangeCombo"
                              Width="160" Margin="0,0,8,0"
                              SelectionChanged="PresetRangeCombo_SelectionChanged">
                        <ComboBoxItem Content="(brak)"/>
                        <ComboBoxItem Content="Dzisiaj"/>
                        <ComboBoxItem Content="Ten tydzień"/>
                        <ComboBoxItem Content="Ten miesiąc"/>
                        <ComboBoxItem Content="Ten rok"/>
                    </ComboBox>

                    <ComboBox x:Name="CategoryFilterComboBox" Width="180" Margin="0,0,8,0" IsEditable="True"/>
                    <DatePicker x:Name="FromDatePicker" Width="140" Margin="0,0,8,0"/>
                    <DatePicker x:Name="ToDatePicker"   Width="140" Margin="0,0,8,0"/>

                    <TextBox x:Name="QueryTextBox" Width="220" Margin="0,0,8,0"
                             Style="{StaticResource WatermarkTextBox}"
                             Tag="Szukaj w opisie…"/>

                    <Button Content="Filtruj"
                            Style="{StaticResource PrimaryButton}"
                            Click="FilterButton_Click"/>
                    <Button Content="Wyczyść"
                            Margin="8,0,0,0"
                            Click="ClearFilters_Click"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- ===== LISTA WYDATKÓW ===== -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,0,0,12">
            <DataGrid x:Name="ExpenseGrid"
                      AutoGenerateColumns="False"
                      HeadersVisibility="Column"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      MouseDoubleClick="ExpenseGrid_MouseDoubleClick">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Data"
                                        Binding="{Binding Date, StringFormat={}{0:yyyy-MM-dd}}"
                                        Width="140"/>
                    <DataGridTextColumn Header="Kategoria"
                                        Binding="{Binding Category}"
                                        Width="*"/>
                    <DataGridTextColumn Header="Kwota"
                                        Binding="{Binding Amount, StringFormat={}{0:N2} zł}"
                                        Width="140"
                                        ElementStyle="{StaticResource RightAlignedCell}"/>
                    <DataGridTextColumn Header="Opis"
                                        Binding="{Binding Description}"
                                        Width="2*"/>

                    <DataGridTemplateColumn Header="Akcje" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="Edytuj" Padding="10,4" Margin="0,0,6,0"
                                            Tag="{Binding Id}" Click="EditExpense_Click"/>
                                    <Button Content="Usuń" Padding="10,4"
                                            Tag="{Binding Id}" Click="DeleteExpense_Click"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- ===== DOLNY PASEK ===== -->
        <DockPanel Grid.Row="3" LastChildFill="False" Margin="0,8,0,0">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                <TextBox x:Name="QuickAddBox" Width="320" Margin="0,0,8,0"
                         Style="{StaticResource WatermarkTextBox}"
                         Tag="Szybkie dodawanie: np. 35,90 #zakupy @karta"/>
                <Button Content="Dodaj"
                        Style="{StaticResource PrimaryButton}"
                        Click="QuickAdd_Click"/>
                <Button Content="Usuń zaznaczony"
                        Margin="8,0,0,0"
                        Click="DeleteSelected_Click"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                <Button Content="Wykres wydatków" Click="ShowChart_Click"/>
            </StackPanel>
        </DockPanel>
    </Grid>
</UserControl>

