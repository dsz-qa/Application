<UserControl x:Class="Finly.Pages.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:Finly.Views.Controls"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             x:Name="Root"
             Background="{DynamicResource App.Background}">

    <UserControl.Resources>

        <!-- ===================== DASHBOARD-ONLY STYLES ===================== -->

        <!-- Karty -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="12"/>
        </Style>

        <Style x:Key="AccentOrangeCard" TargetType="Border" BasedOn="{StaticResource Card}">
            <Setter Property="BorderBrush" Value="{DynamicResource Brand.Orange}"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>

        <!-- Nagłówki kart -->
        <Style x:Key="CardHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
        </Style>

        <!-- KPI -->
        <Style x:Key="KpiValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,2,0,0"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
        </Style>

        <Style x:Key="KpiHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
        </Style>

        <Style x:Key="KpiCard" TargetType="Border">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,16,0"/>
        </Style>

        <!-- Mini etykiety -->
        <Style x:Key="MiniLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            <Setter Property="Opacity" Value="0.85"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="MiniValue" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <!-- Nagłówek tabeli/listy -->
        <Style x:Key="TableHeaderText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>

        <!-- fallbacki -->
        <Style x:Key="FinancialAnalysisCardBorderStyle" TargetType="Border" BasedOn="{StaticResource Card}">
            <Setter Property="Padding" Value="16"/>
        </Style>

        <Style x:Key="FinancialAnalysisCardHeaderStyle" TargetType="TextBlock" BasedOn="{StaticResource CardHeader}">
            <Setter Property="FontSize" Value="16"/>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="{DynamicResource Brand.Blue}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
        </Style>

        <!-- Wspólny styl na długie teksty -->
        <Style x:Key="EllipsizeWithTooltip" TargetType="TextBlock">
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="TextWrapping" Value="NoWrap"/>
            <Setter Property="ToolTip" Value="{Binding RelativeSource={RelativeSource Self}, Path=Text}"/>
        </Style>

        <!-- Donut cards: większa przestrzeń na wykres + środek -->
        <Style x:Key="DonutCard" TargetType="Border" BasedOn="{StaticResource Card}">
            <Setter Property="Padding" Value="10"/>
            <Setter Property="MinHeight" Value="360"/>
        </Style>

    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  PanningMode="VerticalOnly">

        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- ================= KPI ================= -->
            <Grid Grid.Row="0" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="Cały majątek" Style="{StaticResource KpiHeader}"/>
                        <TextBlock x:Name="TotalWealthText" Style="{StaticResource KpiValueStyle}" Text="0,00 zł"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="Konta bankowe" Style="{StaticResource KpiHeader}"/>
                        <TextBlock x:Name="BanksText" Style="{StaticResource KpiValueStyle}" Text="0,00 zł"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="Wolna gotówka" Style="{StaticResource KpiHeader}"/>
                        <TextBlock x:Name="FreeCashDashboardText" Style="{StaticResource KpiValueStyle}" Text="0,00 zł"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="3" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="Gotówka odłożona" Style="{StaticResource KpiHeader}" TextWrapping="Wrap"/>
                        <TextBlock x:Name="SavedToAllocateText" Style="{StaticResource KpiValueStyle}" Text="0,00 zł"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="4" Style="{StaticResource KpiCard}">
                    <StackPanel HorizontalAlignment="Left">
                        <TextBlock Text="Gotówka w kopertach"
                                   Style="{StaticResource KpiHeader}"
                                   TextWrapping="Wrap"
                                   TextAlignment="Left"/>
                        <TextBlock x:Name="EnvelopesDashboardText"
                                   Style="{StaticResource KpiValueStyle}"
                                   Text="0,00 zł"
                                   TextWrapping="Wrap"
                                   TextAlignment="Left"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="5" Style="{StaticResource KpiCard}" Margin="0">
                    <StackPanel>
                        <TextBlock Text="Inwestycje" Style="{StaticResource KpiHeader}"/>
                        <TextBlock x:Name="InvestmentsText" Style="{StaticResource KpiValueStyle}" Text="0,00 zł"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- ================= Analizy / Alerty / Prognoza ================= -->
            <Grid Grid.Row="1" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Analizy -->
                <Border Grid.Column="0" Style="{StaticResource AccentOrangeCard}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="Analizy finansowe" Style="{StaticResource FinancialAnalysisCardHeaderStyle}" Margin="0,0,0,10"/>
                        <ItemsControl ItemsSource="{Binding DataContext.Insights, ElementName=Root}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                               Foreground="{DynamicResource App.Foreground}"
                                               Margin="0,2,0,2"
                                               TextWrapping="Wrap"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Alerty -->
                <Border Grid.Column="1" Style="{StaticResource AccentOrangeCard}" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="Alerty budżetowe" Style="{StaticResource FinancialAnalysisCardHeaderStyle}" Margin="0,0,0,10"/>
                        <ItemsControl ItemsSource="{Binding DataContext.Alerts, ElementName=Root}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                               Foreground="{DynamicResource App.Foreground}"
                                               Margin="0,2,0,2"
                                               TextWrapping="Wrap"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Prognoza -->
                <Border Grid.Column="2" Style="{StaticResource AccentOrangeCard}">
                    <StackPanel>
                        <TextBlock Text="Prognoza końca miesiąca" Style="{StaticResource FinancialAnalysisCardHeaderStyle}" Margin="0,0,0,10"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="Przew. wydatki" Style="{StaticResource MiniLabel}"/>
                                <TextBlock Text="{Binding DataContext.Forecast.PredictedSpending, ElementName=Root, StringFormat={}{0:N2} zł}"
                                           Style="{StaticResource MiniValue}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Przew. wolne środki" Style="{StaticResource MiniLabel}"/>
                                <TextBlock Text="{Binding DataContext.Forecast.PredictedFreeCash, ElementName=Root, StringFormat={}{0:N2} zł}"
                                           Style="{StaticResource MiniValue}"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- ================= Główna część ================= -->
            <Border Grid.Row="2" Style="{StaticResource Card}" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Pasek okresu -->
                    <StackPanel Grid.Row="0" Grid.ColumnSpan="2" HorizontalAlignment="Center" Margin="0,0,0,10">
                        <controls:PeriodBarControl x:Name="PeriodBar"
                                                   RangeChanged="PeriodBar_RangeChanged"
                                                   SearchClicked="PeriodBar_SearchClicked"
                                                   ClearClicked="PeriodBar_ClearClicked"/>
                        <Border Height="3"
                                Background="{DynamicResource Brand.Blue}"
                                CornerRadius="0,0,8,8"
                                Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- ================= WYKRESY KOŁOWE (powiększone) ================= -->
                    <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource DonutCard}" Margin="0,0,8,0">
                        <StackPanel>
                            <TextBlock Text="Źródła przychodu — bieżący okres"
                                       Style="{StaticResource CardHeader}"
                                       Margin="0,0,0,8"/>

                            <!-- większa wysokość = większy donut + środek -->
                            <controls:DonutChartControl x:Name="IncomeDonut"
                                                        Height="320"
                                                        Title="Źródła przychodu"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource DonutCard}" Margin="8,0,0,0">
                        <StackPanel>
                            <TextBlock Text="Wydatki wg kategorii — bieżący okres"
                                       Style="{StaticResource CardHeader}"
                                       Margin="0,0,0,8"/>

                            <controls:DonutChartControl x:Name="ExpenseDonut"
                                                        Height="320"
                                                        Title="Wydatki wg kategorii"/>
                        </StackPanel>
                    </Border>

                    <!-- ================= Sekcja dolna 2x3 ================= -->
                    <Grid Grid.Row="2" Grid.ColumnSpan="2" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Trend -->
                        <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource Card}" Margin="0,0,8,8">
                            <StackPanel>
                                <TextBlock Text="Trend wydatków — bieżący okres"
                                           Style="{StaticResource FinancialAnalysisCardHeaderStyle}"
                                           Margin="0,0,0,8"/>
                                <Canvas x:Name="ExpenseTrendCanvas" Height="180" Margin="0,0,0,4"/>
                                <ItemsControl x:Name="ExpenseTrendLabels" Visibility="Collapsed" Margin="0,4,0,0">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Rows="1"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DateLabel}"
                                                       Foreground="{DynamicResource App.Foreground}"
                                                       FontSize="10"
                                                       HorizontalAlignment="Center"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock x:Name="ExpenseTrendEmptyText"
                                           Text="Brak danych w tym okresie"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Visibility="Collapsed"
                                           HorizontalAlignment="Center"
                                           FontStyle="Italic"/>
                            </StackPanel>
                        </Border>

                        <!-- Najwyższe wydatki -->
                        <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource Card}" Margin="8,0,0,8">
                            <StackPanel>
                                <TextBlock Text="Najwyższe wydatki — kategorie"
                                           Style="{StaticResource CardHeader}"
                                           Margin="0,0,0,8"/>

                                <ItemsControl x:Name="TopCategoryBars">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="0,4,0,6">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Text="{Binding Name}"
                                                               Foreground="{DynamicResource App.Foreground}"
                                                               Margin="0,0,8,2"
                                                               Style="{StaticResource EllipsizeWithTooltip}"/>

                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding PercentStr}"
                                                               Foreground="{DynamicResource App.Foreground}"/>
                                                </Grid>

                                                <ProgressBar Minimum="0" Maximum="100" Height="10" Value="{Binding Percent}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <TextBlock x:Name="TopCategoryEmptyText"
                                           Text="Brak danych w tym okresie"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Visibility="Collapsed"
                                           HorizontalAlignment="Center"
                                           Margin="4,8,4,0"
                                           FontStyle="Italic"/>
                            </StackPanel>
                        </Border>

                        <!-- ================= PRZYCHODY ================= -->
                        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource Card}" Margin="0,0,8,8">
                            <StackPanel>

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Przychody — bieżący okres"
                                               Style="{StaticResource CardHeader}"
                                               VerticalAlignment="Center"/>

                                    <!-- globalny styl DeleteIconButton -->
                                    <Button Grid.Column="1"
                                            Style="{StaticResource DeleteIconButton}"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Panel.ZIndex="10"
                                            ToolTip="Usuń zaznaczony"
                                            Click="ShowIncomeDeleteConfirm_Click"/>
                                </Grid>

                                <StackPanel x:Name="IncomeDeleteConfirmPanel"
                                            Orientation="Horizontal"
                                            Visibility="Collapsed"
                                            Margin="0,0,0,8"
                                            HorizontalAlignment="Left">
                                    <TextBlock Text="Czy na pewno chcesz usunąć przychód?"
                                               Foreground="{DynamicResource App.Foreground}"
                                               Margin="0,0,8,0"/>
                                    <Button Content="Tak"
                                            Width="60"
                                            Margin="0,0,6,0"
                                            Click="IncomeDeleteConfirmYes_Click"
                                            Style="{StaticResource PrimaryButton}"/>
                                    <Button Content="Nie"
                                            Width="60"
                                            Click="IncomeDeleteConfirmNo_Click"
                                            Style="{StaticResource SecondaryButton}"/>
                                </StackPanel>

                                <Border Margin="0,0,0,4"
                                        Background="{DynamicResource Surface.Background}"
                                        Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="90"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="140"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Data" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="1" Text="Kwota" Style="{StaticResource TableHeaderText}" HorizontalAlignment="Right"/>
                                        <TextBlock Grid.Column="2" Text="Kategoria" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="3" Text="Z/Na konto" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="4" Text="Opis" Style="{StaticResource TableHeaderText}"/>
                                    </Grid>
                                </Border>

                                <ListBox x:Name="IncomeTable"
                                         ItemsSource="{Binding DataContext.Incomes, ElementName=Root}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="90"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="2*"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" Text="{Binding DateDisplay}" Foreground="{DynamicResource App.Foreground}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding AmountStr}" HorizontalAlignment="Right" Foreground="{DynamicResource App.Foreground}"/>

                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding Category}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="3"
                                                           Text="{Binding Account}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="4"
                                                           Text="{Binding Description}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <TextBlock x:Name="IncomeEmptyText"
                                           Text="Brak danych w tym okresie"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Visibility="Collapsed"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,0"
                                           FontStyle="Italic"/>
                            </StackPanel>
                        </Border>

                        <!-- ================= WYDATKI ================= -->
                        <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource Card}" Margin="8,0,0,8">
                            <StackPanel>

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Wydatki — bieżący okres"
                                               Style="{StaticResource CardHeader}"
                                               VerticalAlignment="Center"/>

                                    <Button Grid.Column="1"
                                            Style="{StaticResource DeleteIconButton}"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Panel.ZIndex="10"
                                            ToolTip="Usuń zaznaczony"
                                            Click="ShowExpenseDeleteConfirm_Click"/>
                                </Grid>

                                <StackPanel x:Name="ExpenseDeleteConfirmPanel"
                                            Orientation="Horizontal"
                                            Visibility="Collapsed"
                                            Margin="0,0,0,8"
                                            HorizontalAlignment="Left">
                                    <TextBlock Text="Czy na pewno chcesz usunąć wydatek?"
                                               Foreground="{DynamicResource App.Foreground}"
                                               Margin="0,0,8,0"/>
                                    <Button Content="Tak" Width="60" Margin="0,0,6,0"
                                            Click="ExpenseDeleteConfirmYes_Click"
                                            Style="{StaticResource PrimaryButton}"/>
                                    <Button Content="Nie" Width="60"
                                            Click="ExpenseDeleteConfirmNo_Click"
                                            Style="{StaticResource SecondaryButton}"/>
                                </StackPanel>

                                <Border Margin="0,0,0,4"
                                        Background="{DynamicResource Surface.Background}"
                                        Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="90"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="140"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Data" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="1" Text="Kwota" Style="{StaticResource TableHeaderText}" HorizontalAlignment="Right"/>
                                        <TextBlock Grid.Column="2" Text="Kategoria" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="3" Text="Z/Na konto" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="4" Text="Opis" Style="{StaticResource TableHeaderText}"/>
                                    </Grid>
                                </Border>

                                <ListBox x:Name="ExpenseTable"
                                         ItemsSource="{Binding DataContext.Expenses, ElementName=Root}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="90"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="2*"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" Text="{Binding DateDisplay}" Foreground="{DynamicResource App.Foreground}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding AmountStr}" HorizontalAlignment="Right" Foreground="{DynamicResource App.Foreground}"/>

                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding Category}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="3"
                                                           Text="{Binding Account}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="4"
                                                           Text="{Binding Description}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <TextBlock x:Name="ExpenseEmptyText"
                                           Text="Brak danych w tym okresie"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Visibility="Collapsed"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,0"
                                           FontStyle="Italic"/>
                            </StackPanel>
                        </Border>

                        <!-- Podsumowanie -->
                        <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource Card}" Margin="0,0,8,0">
                            <StackPanel>
                                <TextBlock Text="Podsumowanie — bieżący okres"
                                           Style="{StaticResource CardHeader}"
                                           Margin="0,0,0,8"/>
                                <TextBlock x:Name="PeriodIncomeSummaryText" Foreground="{DynamicResource App.Foreground}" Margin="0,0,0,4"/>
                                <TextBlock x:Name="PeriodExpenseSummaryText" Foreground="{DynamicResource App.Foreground}" Margin="0,0,0,4"/>
                                <TextBlock x:Name="PeriodBalanceSummaryText" Foreground="{DynamicResource App.Foreground}" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <!-- Zaplanowane transakcje -->
                        <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource Card}" Margin="8,0,0,0">
                            <StackPanel>

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Zaplanowane transakcje"
                                               Style="{StaticResource CardHeader}"
                                               VerticalAlignment="Center"/>

                                    <Button Grid.Column="1"
                                            Style="{StaticResource DeleteIconButton}"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Panel.ZIndex="10"
                                            ToolTip="Usuń zaznaczony"
                                            Click="ShowPlannedDeleteConfirm_Click"/>
                                </Grid>

                                <StackPanel x:Name="PlannedDeleteConfirmPanel"
                                            Orientation="Horizontal"
                                            Visibility="Collapsed"
                                            Margin="0,0,0,8"
                                            HorizontalAlignment="Left">
                                    <TextBlock Text="Czy na pewno chcesz usunąć transakcję?"
                                               Foreground="{DynamicResource App.Foreground}"
                                               Margin="0,0,8,0"/>
                                    <Button Content="Tak" Width="60" Margin="0,0,6,0"
                                            Click="PlannedDeleteConfirmYes_Click"
                                            Style="{StaticResource PrimaryButton}"/>
                                    <Button Content="Nie" Width="60"
                                            Click="PlannedDeleteConfirmNo_Click"
                                            Style="{StaticResource SecondaryButton}"/>
                                </StackPanel>

                                <Border Margin="0,0,0,4"
                                        Background="{DynamicResource Surface.Background}"
                                        Padding="6,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="90"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="140"/>
                                            <ColumnDefinition Width="2*"/>
                                            <ColumnDefinition Width="120"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Data" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="1" Text="Kwota" Style="{StaticResource TableHeaderText}" HorizontalAlignment="Right"/>
                                        <TextBlock Grid.Column="2" Text="Kategoria" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="3" Text="Z/Na konto" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="4" Text="Opis" Style="{StaticResource TableHeaderText}"/>
                                        <TextBlock Grid.Column="5" Text="Typ" Style="{StaticResource TableHeaderText}"/>
                                    </Grid>
                                </Border>

                                <ListBox x:Name="PlannedTransactionsList"
                                         ItemsSource="{Binding DataContext.PlannedTransactions, ElementName=Root}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="90"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="120"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" Text="{Binding DateDisplay}" Foreground="{DynamicResource App.Foreground}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding AmountStr}" HorizontalAlignment="Right" Foreground="{DynamicResource App.Foreground}"/>

                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding Category}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="3"
                                                           Text="{Binding Account}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="4"
                                                           Text="{Binding Description}"
                                                           Foreground="{DynamicResource App.Foreground}"
                                                           Style="{StaticResource EllipsizeWithTooltip}"/>

                                                <TextBlock Grid.Column="5" Text="{Binding Kind}" Foreground="{DynamicResource App.Foreground}" FontWeight="SemiBold"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <TextBlock x:Name="PlannedEmptyText"
                                           Text="Brak zaplanowanych transakcji"
                                           Foreground="{DynamicResource App.Foreground}"
                                           Visibility="Collapsed"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,0"
                                           FontStyle="Italic"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
