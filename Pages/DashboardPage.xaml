<UserControl x:Class="Finly.Pages.DashboardPage"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:controls="clr-namespace:Finly.Views.Controls">

 <UserControl.Resources>
 <!-- Karty -->
 <Style x:Key="Card" TargetType="Border">
 <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
 <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
 <Setter Property="BorderThickness" Value="1"/>
 <Setter Property="CornerRadius" Value="10"/>
 <Setter Property="Padding" Value="12"/>
 <Setter Property="Margin" Value="0,0,12,0"/>
 </Style>

 <Style x:Key="AccentCard" TargetType="Border" BasedOn="{StaticResource Card}">
 <Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
 <Setter Property="BorderThickness" Value="1.5"/>
 </Style>

 <Style x:Key="CardHeader" TargetType="TextBlock">
 <Setter Property="FontSize" Value="13"/>
 <Setter Property="FontWeight" Value="SemiBold"/>
 <Setter Property="Opacity" Value="0.9"/>
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 </Style>

 <Style x:Key="KpiValueStyle" TargetType="TextBlock">
 <Setter Property="FontSize" Value="18"/>
 <Setter Property="FontWeight" Value="Bold"/>
 <Setter Property="Margin" Value="0,2,0,0"/>
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 </Style>

 <Style x:Key="KpiCard" TargetType="Border">
 <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
 <Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
 <Setter Property="BorderThickness" Value="2"/>
 <Setter Property="CornerRadius" Value="10"/>
 <Setter Property="Padding" Value="12"/>
 <Setter Property="Margin" Value="0,0,16,0"/>
 </Style>
 <!-- Tekst DatePickera na dashboardzie -->
 <Style TargetType="{x:Type DatePickerTextBox}">
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
 <Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
 <Setter Property="BorderThickness" Value="1.5"/>
 </Style>
 </UserControl.Resources>

 <Grid Margin="16">
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 </Grid.RowDefinitions>

 <!-- ========== KPI (rząd0) ========== -->
 <Grid Grid.Row="0" Margin="0,0,0,12">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="*" />
 </Grid.ColumnDefinitions>

 <!-- Cały majątek -->
 <Border Grid.Column="0" Style="{StaticResource KpiCard}">
 <StackPanel>
 <TextBlock Text="Cały majątek" FontSize="13" Opacity="0.8"/>
 <TextBlock x:Name="TotalWealthText"
 Style="{StaticResource KpiValueStyle}"
 Text="0,00 zł"/>
 </StackPanel>
 </Border>

 <!-- Konta bankowe -->
 <Border Grid.Column="1" Style="{StaticResource KpiCard}">
 <StackPanel>
 <TextBlock Text="Konta bankowe" FontSize="13" Opacity="0.8"/>
 <TextBlock x:Name="BanksText"
 Style="{StaticResource KpiValueStyle}"
 Text="0,00 zł"/>
 </StackPanel>
 </Border>

 <!-- Wolna gotówka -->
 <Border Grid.Column="2" Style="{StaticResource KpiCard}">
 <StackPanel>
 <TextBlock Text="Wolna gotówka" FontSize="13" Opacity="0.8"/>
 <TextBlock x:Name="FreeCashDashboardText"
 Style="{StaticResource KpiValueStyle}"
 Text="0,00 zł"/>
 </StackPanel>
 </Border>

 <!-- Odłożona gotówka -->
 <Border Grid.Column="3" Style="{StaticResource KpiCard}">
 <StackPanel>
 <TextBlock Text="Odłożona gotówka (do rozdysponowania)"
 FontSize="13" Opacity="0.8" TextWrapping="Wrap"/>
 <TextBlock x:Name="SavedToAllocateText"
 Style="{StaticResource KpiValueStyle}"
 Text="0,00 zł"/>
 </StackPanel>
 </Border>

 <!-- Gotówka w kopertach -->
 <Border Grid.Column="4" Style="{StaticResource KpiCard}">
 <StackPanel>
 <TextBlock Text="Gotówka w kopertach" FontSize="13" Opacity="0.8"/>
 <TextBlock x:Name="EnvelopesDashboardText"
 Style="{StaticResource KpiValueStyle}"
 Text="0,00 zł"/>
 </StackPanel>
 </Border>

 <!-- Inwestycje -->
 <Border Grid.Column="5" Style="{StaticResource KpiCard}">
 <StackPanel>
 <TextBlock Text="Inwestycje" FontSize="13" Opacity="0.8"/>
 <TextBlock x:Name="InvestmentsText"
 Style="{StaticResource KpiValueStyle}"
 Text="0,00 zł"/>
 </StackPanel>
 </Border>
 </Grid>

 <!-- ====== WRAP EVERYTHING EXCEPT KPI INTO ONE FRAME ====== -->
 <Border Grid.Row="1" Grid.RowSpan="2" Style="{StaticResource AccentCard}" Padding="16" HorizontalAlignment="Stretch">
 <StackPanel>
 <!-- Reuse the PeriodBarControl from Reports for identical look/behavior -->
 <controls:PeriodBarControl x:Name="PeriodBar"
 HorizontalAlignment="Center"
 Margin="0,0,0,8"
 RangeChanged="PeriodBar_RangeChanged"
 SearchClicked="PeriodBar_SearchClicked"
 ClearClicked="PeriodBar_ClearClicked" />

 <!-- ========== TREŚĆ (content) ========== -->
 <Grid Margin="0,8,0,0">
 <Grid.ColumnDefinitions>
 <!--3 kolumny: wykresy, tabele, trend -->
 <ColumnDefinition Width="*" MinWidth="380"/>
 <ColumnDefinition Width="*" MinWidth="380"/>
 <ColumnDefinition Width="*" MinWidth="380"/>
 </Grid.ColumnDefinitions>

 <!-- ===== KOLUMNA1: DONUTY ===== -->
 <Grid Grid.Column="0" Margin="0,0,8,0">
 <Grid.RowDefinitions>
 <RowDefinition Height="*" />
 <RowDefinition Height="*" />
 </Grid.RowDefinitions>

 <!-- DONUT WYDATKÓW -->
 <Border Grid.Row="0" Style="{StaticResource Card}" MinHeight="260">
 <StackPanel>
 <TextBlock Text="Wydatki wg kategorii — bieżący okres"
 Style="{StaticResource CardHeader}"
 Margin="0,0,0,8"
 TextWrapping="Wrap"/>

 <!-- Viewbox skaluje wykres tak, żeby zawsze mieścił się w karcie -->
 <Viewbox x:Name="ExpenseDonutViewbox" Height="220"
 HorizontalAlignment="Center"
 VerticalAlignment="Center"
 Stretch="Uniform">
 <Grid Width="220" Height="220">
 <Ellipse Width="220" Height="220"
 Fill="#11000000"
 Stroke="{DynamicResource Surface.Border}"
 StrokeThickness="1"/>

 <ItemsControl ItemsSource="{Binding PieCurrent}">
 <ItemsControl.ItemsPanel>
 <ItemsPanelTemplate>
 <Canvas Width="220" Height="220"/>
 </ItemsPanelTemplate>
 </ItemsControl.ItemsPanel>
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Path Data="{Binding Geometry}"
 Fill="{Binding Brush}"
 Stroke="{DynamicResource Surface.Background}"
 StrokeThickness="1"
 MouseLeftButtonDown="PieSlice_MouseLeftButtonDown"/>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>

 <!-- opis w środku koła -->
 <StackPanel HorizontalAlignment="Center"
 VerticalAlignment="Center"
 MaxWidth="170">
 <TextBlock x:Name="PieCenterNameText"
 FontSize="14"
 FontWeight="SemiBold"
 Foreground="White"
 TextAlignment="Center"
 TextWrapping="Wrap"
 Margin="0,0,0,4"/>
 <TextBlock x:Name="PieCenterValueText"
 FontSize="18"
 FontWeight="Bold"
 Foreground="White"
 TextAlignment="Center"
 Margin="0,0,0,2"/>
 <TextBlock x:Name="PieCenterPercentText"
 FontSize="11"
 Foreground="White"
 Opacity="0.8"
 TextAlignment="Center"
 TextWrapping="Wrap"/>
 </StackPanel>

 <!-- Empty placeholder -->
 <TextBlock x:Name="DonutExpenseEmptyText" Text="Brak danych w tym okresie" Foreground="{DynamicResource App.Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed" FontStyle="Italic"/>
 </Grid>
 </Viewbox>
 </StackPanel>
 </Border>

 <!-- DONUT PRZYCHODÓW -->
 <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,12,0,0" MinHeight="260">
 <StackPanel>
 <TextBlock Text="Źródła przychodu — bieżący okres"
 Style="{StaticResource CardHeader}"
 Margin="0,0,0,8"
 TextWrapping="Wrap"/>

 <Viewbox x:Name="IncomeDonutViewbox" Height="220"
 HorizontalAlignment="Center"
 VerticalAlignment="Center"
 Stretch="Uniform">
 <Grid Width="220" Height="220">
 <Ellipse Width="220" Height="220"
 Fill="#11000000"
 Stroke="{DynamicResource Surface.Border}"
 StrokeThickness="1"/>

 <ItemsControl ItemsSource="{Binding PieIncome}">
 <ItemsControl.ItemsPanel>
 <ItemsPanelTemplate>
 <Canvas Width="220" Height="220"/>
 </ItemsPanelTemplate>
 </ItemsControl.ItemsPanel>
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Path Data="{Binding Geometry}"
 Fill="{Binding Brush}"
 Stroke="{DynamicResource Surface.Background}"
 StrokeThickness="1"
 MouseLeftButtonDown="IncomePieSlice_MouseLeftButtonDown"/>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>

 <StackPanel HorizontalAlignment="Center"
 VerticalAlignment="Center"
 MaxWidth="170">
 <TextBlock x:Name="IncomeCenterNameText"
 Text="Przychód"
 FontSize="14"
 FontWeight="SemiBold"
 Foreground="White"
 TextAlignment="Center"
 Margin="0,0,0,4"/>
 <TextBlock x:Name="IncomeCenterValueText"
 FontSize="18"
 FontWeight="Bold"
 Foreground="White"
 TextAlignment="Center"
 Margin="0,0,0,2"/>
 <TextBlock x:Name="IncomeCenterPercentText"
 FontSize="11"
 Foreground="White"
 Opacity="0.8"
 TextAlignment="Center"
 TextWrapping="Wrap"/>
 </StackPanel>

 <!-- Empty placeholder -->
 <TextBlock x:Name="DonutIncomeEmptyText" Text="Brak danych w tym okresie" Foreground="{DynamicResource App.Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed" FontStyle="Italic"/>
 </Grid>
 </Viewbox>
 </StackPanel>
 </Border>
 </Grid>

 <!-- ===== KOLUMNA2: TABELKI W ŚRODKU ===== -->
 <Grid Grid.Column="1" Margin="4,0,4,0">
 <Grid.RowDefinitions>
 <RowDefinition Height="*" />
 <RowDefinition Height="*" />
 </Grid.RowDefinitions>

 <!-- PRZYCHODY -->
 <Border Grid.Row="0" Style="{StaticResource Card}" MinHeight="120">
 <StackPanel>
 <TextBlock Text="Przychody — bieżący okres"
 Style="{StaticResource CardHeader}"
 Margin="0,0,0,8"
 TextWrapping="Wrap"/>

 <!-- NAGŁÓWEK: Kategoria | Kwota | Procent -->
 <Grid Margin="0,0,0,4">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="110" />
 <ColumnDefinition Width="70" />
 </Grid.ColumnDefinitions>

 <TextBlock Grid.Column="0"
 Text="Kategoria"
 FontSize="11"
 FontWeight="SemiBold"
 Foreground="{DynamicResource App.Foreground}"
 Opacity="0.8"/>

 <TextBlock Grid.Column="1"
 Text="Kwota"
 FontSize="11"
 FontWeight="SemiBold"
 Foreground="{DynamicResource App.Foreground}"
 Opacity="0.8"
 HorizontalAlignment="Right"/>

 <TextBlock Grid.Column="2"
 Text="Procent"
 FontSize="11"
 FontWeight="SemiBold"
 Foreground="{DynamicResource App.Foreground}"
 Opacity="0.8"
 HorizontalAlignment="Right"/>
 </Grid>

 <!-- bez brzydkiego nagłówka – ItemsControl zamiast ListView -->
 <Grid>
 <ItemsControl x:Name="IncomeTable">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Grid Margin="0,2,0,2">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="110" />
 <ColumnDefinition Width="70" />
 </Grid.ColumnDefinitions>

 <TextBlock Grid.Column="0"
 Text="{Binding Name}"
 Margin="0,0,8,0"
 Foreground="{DynamicResource App.Foreground}"
 TextTrimming="CharacterEllipsis"/>

 <TextBlock Grid.Column="1"
 Text="{Binding AmountStr}"
 HorizontalAlignment="Right"
 Foreground="{DynamicResource App.Foreground}"/>

 <TextBlock Grid.Column="2"
 Text="{Binding PercentStr}"
 HorizontalAlignment="Right"
 Foreground="{DynamicResource App.Foreground}"/>
 </Grid>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 <TextBlock x:Name="IncomeEmptyText" Text="Brak danych w tym okresie" Foreground="{DynamicResource App.Foreground}" Visibility="Collapsed" HorizontalAlignment="Center" Margin="0,8,0,0" FontStyle="Italic"/>
 </Grid>
 </StackPanel>
 </Border>

 <!-- WYDATKI -->
 <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,12,0,0" MinHeight="120">
 <StackPanel>
 <TextBlock Text="Wydatki — bieżący okres"
 Style="{StaticResource CardHeader}"
 Margin="0,0,0,8"
 TextWrapping="Wrap"/>

 <!-- NAGŁÓWEK: Kategoria | Kwota | Procent -->
 <Grid Margin="0,0,0,4">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="110" />
 <ColumnDefinition Width="70" />
 </Grid.ColumnDefinitions>

 <TextBlock Grid.Column="0"
 Text="Kategoria"
 FontSize="11"
 FontWeight="SemiBold"
 Foreground="{DynamicResource App.Foreground}"
 Opacity="0.8"/>

 <TextBlock Grid.Column="1"
 Text="Kwota"
 FontSize="11"
 FontWeight="SemiBold"
 Foreground="{DynamicResource App.Foreground}"
 Opacity="0.8"
 HorizontalAlignment="Right"/>

 <TextBlock Grid.Column="2"
 Text="Procent"
 FontSize="11"
 FontWeight="SemiBold"
 Foreground="{DynamicResource App.Foreground}"
 Opacity="0.8"
 HorizontalAlignment="Right"/>
 </Grid>

 <ItemsControl x:Name="ExpenseTable">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Grid Margin="0,2,0,2">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="110" />
 <ColumnDefinition Width="70" />
 </Grid.ColumnDefinitions>

 <TextBlock Grid.Column="0"
 Text="{Binding Name}"
 Margin="0,0,8,0"
 Foreground="{DynamicResource App.Foreground}"
 TextTrimming="CharacterEllipsis"/>

 <TextBlock Grid.Column="1"
 Text="{Binding AmountStr}"
 HorizontalAlignment="Right"
 Foreground="{DynamicResource App.Foreground}"/>

 <TextBlock Grid.Column="2"
 Text="{Binding PercentStr}"
 HorizontalAlignment="Right"
 Foreground="{DynamicResource App.Foreground}"/>
 </Grid>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 <TextBlock x:Name="ExpenseEmptyText" Text="Brak danych w tym okresie" Foreground="{DynamicResource App.Foreground}" Visibility="Collapsed" HorizontalAlignment="Center" Margin="0,8,0,0" FontStyle="Italic"/>
 </StackPanel>
 </Border>
 </Grid>

 <!-- ===== KOLUMNA3: NAJWYŻSZE WYDATKI + TREND ===== -->
 <Grid Grid.Column="2" Margin="8,0,0,0">
 <Grid.RowDefinitions>
 <RowDefinition Height="*" />
 <RowDefinition Height="*" />
 </Grid.RowDefinitions>

 <!-- NAJWYŻSZE WYDATKI -->
 <Border Grid.Row="0" Style="{StaticResource Card}" MinHeight="120">
 <StackPanel>
 <TextBlock Text="Najwyższe wydatki — kategorie"
 Style="{StaticResource CardHeader}"
 Margin="0,0,0,8"
 TextWrapping="Wrap"/>
 <ItemsControl x:Name="TopCategoryBars">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <StackPanel Margin="0,4,0,6">
 <Grid>
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*" />
 <ColumnDefinition Width="Auto" />
 </Grid.ColumnDefinitions>
 <TextBlock Text="{Binding Name}"
 Foreground="{DynamicResource App.Foreground}"
 Margin="0,0,8,2"
 TextTrimming="CharacterEllipsis"/>
 <TextBlock Grid.Column="1"
 Text="{Binding PercentStr}"
 Foreground="{DynamicResource App.Foreground}"/>
 </Grid>
 <ProgressBar Minimum="0" Maximum="100"
 Height="10"
 Value="{Binding Percent}" />
 </StackPanel>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 <TextBlock x:Name="TopCategoryEmptyText" Text="Brak danych w tym okresie" Foreground="{DynamicResource App.Foreground}" Visibility="Collapsed" HorizontalAlignment="Center" Margin="4,8,4,0" FontStyle="Italic"/>
 </StackPanel>
 </Border>

 <!-- TREND WYDATKÓW - wykres liniowy z dwóch punktów -->
 <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,12,0,0" MinHeight="140">
 <Grid>
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*" />
 <RowDefinition Height="Auto"/>
 </Grid.RowDefinitions>

 <TextBlock Text="Trend wydatków — ostatnie30 dni"
 Style="{StaticResource CardHeader}"
 Margin="0,0,0,8"
 TextWrapping="Wrap"
 Grid.Row="0"/>

 <Canvas x:Name="ExpenseTrendCanvas"
 Grid.Row="1"
 Height="140"
 Margin="0,4,0,4"
 Background="Transparent"/>

 <!-- etykiety okresów pod wykresem -->
 <ItemsControl x:Name="ExpenseTrendLabels"
 Grid.Row="2"
 Margin="0,2,0,0">
 <ItemsControl.ItemsPanel>
 <ItemsPanelTemplate>
 <UniformGrid Rows="1"/>
 </ItemsPanelTemplate>
 </ItemsControl.ItemsPanel>
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <TextBlock Text="{Binding DateLabel}"
 FontSize="10"
 Foreground="{DynamicResource App.Foreground}"
 HorizontalAlignment="Center"/>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 <TextBlock x:Name="ExpenseTrendEmptyText" Text="Brak danych w tym okresie" Foreground="{DynamicResource App.Foreground}" Visibility="Collapsed" HorizontalAlignment="Center" Margin="0,8,0,0" FontStyle="Italic" Grid.Row="1"/>
 </Grid>
 </Border>
 </Grid>
 </Grid>
 </StackPanel>
 </Border>

 </Grid>
</UserControl>
