<UserControl x:Class="Finly.Pages.InvestmentsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:Finly.Pages"
             mc:Ignorable="d"
             Background="{DynamicResource App.Background}">

	<UserControl.Resources>

		<BooleanToVisibilityConverter x:Key="BoolToVisibility"/>

		<!-- Styl jak w GoalsPage -->
		<Style x:Key="Card" TargetType="Border">
			<Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
			<Setter Property="BorderBrush"     Value="{DynamicResource Surface.Border}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius"    Value="10"/>
			<Setter Property="Padding"         Value="12"/>
			<Setter Property="Margin"          Value="0,12,16,0"/>
			<Setter Property="SnapsToDevicePixels" Value="True"/>
		</Style>

		<Style x:Key="AccentCard" TargetType="Border" BasedOn="{StaticResource Card}">
			<Setter Property="BorderBrush"     Value="{DynamicResource Brand.Blue}"/>
			<Setter Property="BorderThickness" Value="2"/>
			<Setter Property="Margin"          Value="0,16,16,0"/>
		</Style>

		<Style x:Key="CardHeader" TargetType="TextBlock">
			<Setter Property="FontSize"   Value="13"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
			<Setter Property="Opacity"    Value="0.9"/>
		</Style>

		<Style x:Key="KpiValueStyle" TargetType="TextBlock">
			<Setter Property="FontSize"   Value="20"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Margin"     Value="0,4,0,0"/>
			<Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
		</Style>

		<!-- KARTA INWESTYCJI -->
		<DataTemplate DataType="{x:Type local:InvestmentVm}">
			<Border Style="{StaticResource Card}" MinWidth="320" MaxWidth="380">
				<StackPanel>

					<!-- Nagłówek -->
					<Grid Margin="0,0,0,8">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<!-- Ikona -->
						<Rectangle Grid.Column="0" Width="24" Height="24" Margin="0,0,8,0" VerticalAlignment="Top" Fill="{DynamicResource Brand.Orange}">
							<Rectangle.OpacityMask>
								<ImageBrush Stretch="Uniform" ImageSource="/Assets/Icons/inwestycje.png"/>
							</Rectangle.OpacityMask>
						</Rectangle>

						<StackPanel Grid.Column="1">
							<TextBlock FontSize="16"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource App.Foreground}"
                                       TextWrapping="Wrap">
								<Run Text="Inwestycja: "/>
								<Run Text="{Binding Name}"/>
							</TextBlock>

							<TextBlock FontSize="12"
                                       Opacity="0.85"
                                       Foreground="{DynamicResource App.Foreground}"
                                       TextWrapping="Wrap">
								<Run Text="{Binding TypeDisplay, Mode=OneWay}"/>
								<Run Text="  •  "/>
								<Run Text="{Binding TargetDate, StringFormat={}{0:dd.MM.yyyy}, TargetNullValue=Brak terminu, Mode=OneWay}"/>
							</TextBlock>
						</StackPanel>
					</Grid>

					<!-- Docelowo -->
					<TextBlock Text="Wartość docelowa" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}" Opacity="0.9"/>
					<TextBlock Text="{Binding TargetAmount, StringFormat={}{0:N2} zł, Mode=OneWay}"
                               Margin="0,2,0,8"
                               Foreground="{DynamicResource App.Foreground}"/>

					<!-- Aktualnie -->
					<TextBlock Text="Aktualna wartość" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}" Opacity="0.9"/>
					<TextBlock Text="{Binding CurrentAmount, StringFormat={}{0:N2} zł, Mode=OneWay}"
                               Margin="0,2,0,8"
                               Foreground="{DynamicResource App.Foreground}"/>

					<!-- Pozostało -->
					<TextBlock Text="Pozostało do celu" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}" Opacity="0.9"/>
					<TextBlock Text="{Binding Remaining, StringFormat={}{0:N2} zł, Mode=OneWay}"
                               Margin="0,2,0,8"
                               Foreground="{DynamicResource App.Foreground}"/>

					<!-- Progres -->
					<TextBlock Text="Zrealizowano" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}" Opacity="0.9"/>
					<StackPanel Margin="0,2,0,8">
						<TextBlock Text="{Binding CompletionPercent, StringFormat={}{0:N0}%, Mode=OneWay}"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<ProgressBar Height="6"
                                     Margin="0,4,0,0"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="{Binding CompletionPercent, Mode=OneWay}"/>
					</StackPanel>

					<!-- Miesięcznie -->
					<TextBlock Text="Miesięcznie potrzebujesz" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}" Opacity="0.9"/>
					<TextBlock Text="{Binding MonthlyNeeded, StringFormat={}{0:N2} zł, Mode=OneWay}"
                               Margin="0,2,0,8"
                               Foreground="{DynamicResource App.Foreground}"/>

					<!-- Opis -->
					<TextBlock Text="Opis" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}" Opacity="0.9"/>
					<TextBlock Text="{Binding Description, Mode=OneWay}"
                               Margin="0,2,0,6"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource App.Foreground}"/>

					<!-- Akcje -->
					<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
						<Button Click="EditInvestment_Click" Style="{StaticResource EditIconButton}" Margin="0,0,8,0"/>
						<Button Click="DeleteInvestment_Click" Style="{StaticResource DeleteIconButton}"/>
					</StackPanel>

					<!-- Potwierdzenie usunięcia (sterowane stanem VM - stabilne) -->
					<Border Margin="0,8,0,0"
                            Padding="10"
                            CornerRadius="8"
                            BorderThickness="1"
                            BorderBrush="{DynamicResource Surface.Border}"
                            Background="{DynamicResource Surface.Background}"
                            Visibility="{Binding IsDeleteConfirmVisible, Converter={StaticResource BoolToVisibility}}">
						<StackPanel>
							<TextBlock Text="Czy na pewno chcesz usunąć tę inwestycję?"
                                       FontSize="12"
                                       Foreground="{DynamicResource App.Foreground}"
                                       Margin="0,0,0,8"
                                       TextWrapping="Wrap"/>

							<StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
								<Button Content="Tak"
                                        Margin="0,0,8,0"
                                        Padding="10,4"
                                        MinWidth="70"
                                        Click="DeleteInvestmentConfirm_Click"/>
								<Button Content="Nie"
                                        Padding="10,4"
                                        MinWidth="70"
                                        Click="DeleteInvestmentCancel_Click"/>
							</StackPanel>
						</StackPanel>
					</Border>

				</StackPanel>
			</Border>
		</DataTemplate>

		<!-- KAFEL „DODAJ INWESTYCJĘ” -->
		<DataTemplate DataType="{x:Type local:AddInvestmentTile}">
			<Border Style="{StaticResource Card}"
                    MinWidth="260"
                    MaxWidth="300"
                    Cursor="Hand"
                    MouseLeftButtonUp="AddInvestmentCard_Click">
				<Grid>
					<Border Margin="10"
                            BorderThickness="1"
                            CornerRadius="8"
                            BorderBrush="{DynamicResource Surface.Border}"/>

					<StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Margin="0,18,0,18">
						<TextBlock Text="+" FontSize="28" FontWeight="Bold" HorizontalAlignment="Center"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBlock Text="Dodaj inwestycję"
                                   Margin="0,6,0,0"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource App.Foreground}"
                                   HorizontalAlignment="Center"/>
					</StackPanel>
				</Grid>
			</Border>
		</DataTemplate>

	</UserControl.Resources>

	<ScrollViewer VerticalScrollBarVisibility="Auto">
		<Grid Margin="24">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<!-- KPI -->
			<Grid Grid.Row="0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<Border Grid.Column="0" Style="{StaticResource AccentCard}">
					<StackPanel>
						<TextBlock Text="Wartość docelowa (łącznie)"
                                   Style="{StaticResource CardHeader}"
                                   FontSize="18"
                                   FontWeight="Bold"/>
						<TextBlock x:Name="TotalTargetText"
                                   Style="{StaticResource KpiValueStyle}"
                                   FontSize="24"/>
					</StackPanel>
				</Border>

				<Border Grid.Column="1" Style="{StaticResource AccentCard}">
					<StackPanel>
						<TextBlock Text="Aktualna wartość (łącznie)"
                                   Style="{StaticResource CardHeader}"
                                   FontSize="18"
                                   FontWeight="Bold"/>
						<TextBlock x:Name="TotalCurrentText"
                                   Style="{StaticResource KpiValueStyle}"
                                   FontSize="24"/>
					</StackPanel>
				</Border>

				<Border Grid.Column="2" Style="{StaticResource AccentCard}">
					<StackPanel>
						<TextBlock Text="Łącznie miesięcznie potrzebujesz"
                                   Style="{StaticResource CardHeader}"
                                   FontSize="18"
                                   FontWeight="Bold"/>
						<TextBlock x:Name="TotalMonthlyText"
                                   Style="{StaticResource KpiValueStyle}"
                                   FontSize="24"/>
					</StackPanel>
				</Border>
			</Grid>

			<!-- LISTA -->
			<StackPanel Grid.Row="1" Margin="0,12,0,0">

				<Separator Height="1"
                           Background="{DynamicResource Surface.Border}"
                           Opacity="0.8"
                           Margin="0,0,0,10"/>

				<TextBlock Text="Inwestycje"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="{DynamicResource App.Foreground}"
                           Margin="0,4,0,12"/>

				<TextBlock x:Name="InvestmentsErrorText"
                           Visibility="Collapsed"
                           Foreground="OrangeRed"
                           Margin="0,0,0,8"
                           TextWrapping="Wrap"/>

				<ItemsControl x:Name="InvestmentsRepeater" Margin="0,6,0,0">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<WrapPanel HorizontalAlignment="Stretch"/>
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
				</ItemsControl>
			</StackPanel>

			<!-- FORM -->
			<Border x:Name="FormBorder"
                    Grid.Row="2"
                    Margin="0,16,0,24"
                    Background="Transparent"
                    BorderBrush="{DynamicResource Surface.Border}"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="16"
                    Visibility="Collapsed">

				<StackPanel HorizontalAlignment="Center" MaxWidth="700">

					<TextBlock x:Name="FormHeader"
                               Text="Dodaj inwestycję"
                               FontSize="18"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource App.Foreground}"/>

					<Grid Margin="0,12,0,0">
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="320"/>
						</Grid.ColumnDefinitions>

						<TextBlock Grid.Row="0" Grid.Column="0" Text="Nazwa:"
                                   Margin="0,4,10,8"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="InvestmentNameBox" Grid.Row="0" Grid.Column="1"/>

						<TextBlock Grid.Row="1" Grid.Column="0" Text="Typ inwestycji:"
                                   Margin="0,4,10,8"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<ComboBox x:Name="InvestmentTypeBox" Grid.Row="1" Grid.Column="1" SelectedIndex="0">
							<ComboBoxItem Content="Inne"/>
							<ComboBoxItem Content="Akcje"/>
							<ComboBoxItem Content="Obligacje"/>
							<ComboBoxItem Content="ETF"/>
							<ComboBoxItem Content="Fundusz"/>
							<ComboBoxItem Content="Kryptowaluty"/>
							<ComboBoxItem Content="Lokata"/>
						</ComboBox>

						<TextBlock Grid.Row="2" Grid.Column="0" Text="Wartość docelowa:"
                                   Margin="0,4,10,8"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="InvestmentTargetBox"
                                 Grid.Row="2" Grid.Column="1"
                                 HorizontalContentAlignment="Right"
                                 Text="0,00"
                                 GotFocus="AmountBox_GotFocus"
                                 LostFocus="AmountBox_LostFocus"/>

						<TextBlock Grid.Row="3" Grid.Column="0" Text="Aktualnie:"
                                   Margin="0,4,10,8"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="InvestmentCurrentBox"
                                 Grid.Row="3" Grid.Column="1"
                                 HorizontalContentAlignment="Right"
                                 Text="0,00"
                                 GotFocus="AmountBox_GotFocus"
                                 LostFocus="AmountBox_LostFocus"/>

						<TextBlock Grid.Row="4" Grid.Column="0" Text="Termin (data):"
                                   Margin="0,4,10,8"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<DatePicker x:Name="InvestmentTargetDatePicker" Grid.Row="4" Grid.Column="1"/>

						<TextBlock Grid.Row="5" Grid.Column="0" Text="Opis:"
                                   Margin="0,4,10,0"
                                   VerticalAlignment="Top"
                                   Foreground="{DynamicResource App.Foreground}"/>
						<TextBox x:Name="InvestmentDescriptionBox"
                                 Grid.Row="5" Grid.Column="1"
                                 Height="70"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"/>
					</Grid>

					<StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Margin="0,12,0,0">
						<Button Content="Zapisz"
                                Width="120"
                                Margin="0,0,8,0"
                                Click="AddInvestment_Click"/>
						<Button Content="Anuluj"
                                Width="120"
                                Click="ClearInvestmentForm_Click"/>
					</StackPanel>

					<TextBlock x:Name="InvestmentFormMessage"
                               Margin="0,10,0,0"
                               HorizontalAlignment="Center"
                               Foreground="OrangeRed"
                               TextWrapping="Wrap"/>
				</StackPanel>
			</Border>

		</Grid>
	</ScrollViewer>
</UserControl>
