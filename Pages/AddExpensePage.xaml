<UserControl x:Class="Finly.Pages.AddExpensePage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <UserControl.Resources>
        <!-- Prosta karta -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="16"/>
        </Style>

        <!-- Czerwony tekst błędu pod polami -->
        <Style x:Key="ErrorTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFE57373"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="2,2,0,0"/>
            <Setter Property="Visibility" Value="Collapsed"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- tytuł -->
            <RowDefinition Height="24"/>
            <!-- odstęp -->
            <RowDefinition Height="Auto"/>
            <!-- pytanie + zakładki -->
            <RowDefinition Height="24"/>
            <!-- odstęp -->
            <RowDefinition Height="*"/>
            <!-- treść -->
        </Grid.RowDefinitions>

        <!-- Nagłówek -->
        <TextBlock Grid.Row="0"
                   Text="Dodaj"
                   FontSize="20"
                   FontWeight="Bold"
                   Foreground="{DynamicResource App.Foreground}"/>

        <!-- Pytanie + zakładki, wyśrodkowane razem -->
        <StackPanel Grid.Row="2"
                    Orientation="Vertical"
                    HorizontalAlignment="Center">
            <TextBlock Text="Co chcesz dodać?"
                       FontSize="22"
                       FontWeight="SemiBold"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource App.Foreground}"
                       Margin="0,0,0,12"/>

            <TabControl x:Name="ModeTabs"
                        Width="680"
                        HorizontalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        SelectionChanged="ModeTabs_SelectionChanged">

                <TabControl.Resources>
                    <!-- WYGLĄD ZAKŁADEK -->
                    <Style TargetType="TabItem">
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="FontSize" Value="18"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="32,10"/>
                        <Setter Property="MinWidth" Value="170"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border x:Name="Bd"
                                            Background="#202020"
                                            CornerRadius="18"
                                            Margin="4,0"
                                            BorderThickness="1"
                                            BorderBrush="Transparent">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"
                                                          ContentSource="Header"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <!-- AKTYWNA zakładka – pomarańczowa ramka -->
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd"
                                                    Property="BorderBrush"
                                                    Value="#FFEB8A00"/>
                                            <Setter TargetName="Bd"
                                                    Property="BorderThickness"
                                                    Value="2"/>
                                            <Setter Property="Foreground"
                                                    Value="White"/>
                                        </Trigger>

                                        <!-- HOVER – delikatna ramka -->
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd"
                                                    Property="BorderBrush"
                                                    Value="#80EB8A00"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>

                    <!-- NAGŁÓWKI Z IKONAMI -->
                    <DataTemplate x:Key="IncomeHeaderTemplate">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Image Source="/Assets/Icons/przychody.png"
                                   Width="22" Height="22"
                                   Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>

                    <DataTemplate x:Key="ExpenseHeaderTemplate">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Image Source="/Assets/Icons/wydatki.png"
                                   Width="22" Height="22"
                                   Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>

                    <DataTemplate x:Key="TransferHeaderTemplate">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Image Source="/Assets/Icons/transfer.png"
                                   Width="22" Height="22"
                                   Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </TabControl.Resources>

                <TabItem Header="Przychód"
                         HeaderTemplate="{StaticResource IncomeHeaderTemplate}"/>
                <TabItem Header="Wydatek"
                         HeaderTemplate="{StaticResource ExpenseHeaderTemplate}"/>
                <TabItem Header="Transfer"
                         HeaderTemplate="{StaticResource TransferHeaderTemplate}"/>
            </TabControl>
        </StackPanel>

        <!-- ===================== TREŚĆ ===================== -->

        <!-- ========== WYDATEK ========== -->
        <Border x:Name="ExpensePanel"
                Grid.Row="4"
                Style="{StaticResource Card}"
                Margin="0,0,0,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <!-- kolejność: Kwota, Kategoria, Nowa kategoria, Data, Skąd płacisz, Koperta/Konto, Opis, Przyciski -->
                    <RowDefinition Height="Auto"/>
                    <!-- 0 Kwota -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 2 Kategoria -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 4 Nowa kategoria -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 6 Data -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 8 Skąd płacisz -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 10 Koperta/Konto (gridy) -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 12 Opis -->
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 14 Przyciski -->
                </Grid.RowDefinitions>

                <!-- Kwota -->
                <TextBlock Grid.Row="0" Grid.Column="0"
                           Text="Kwota:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>

                <StackPanel Grid.Row="0" Grid.Column="1">
                    <TextBox x:Name="ExpenseAmountBox"
                             Height="28"/>
                    <TextBlock x:Name="ExpenseAmountErrorText"
                               Style="{StaticResource ErrorTextStyle}"
                               Text="Podaj poprawną kwotę."/>
                </StackPanel>

                <!-- Kategoria (lista) -->
                <TextBlock Grid.Row="2" Grid.Column="0"
                           Text="Kategoria:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="ExpenseCategoryBox"
                          Grid.Row="2" Grid.Column="1"
                          Height="28"
                          IsEditable="False"/>

                <!-- Nowa kategoria -->
                <TextBlock Grid.Row="4" Grid.Column="0"
                           Text="Nowa kategoria (opcjonalnie):"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBox x:Name="ExpenseNewCategoryBox"
                         Grid.Row="4" Grid.Column="1"
                         Height="28"/>

                <!-- Data -->
                <TextBlock Grid.Row="6" Grid.Column="0"
                           Text="Data:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <DatePicker x:Name="ExpenseDatePicker"
                            Grid.Row="6" Grid.Column="1"
                            Height="28"/>

                <!-- Skąd płacisz -->
                <TextBlock Grid.Row="8" Grid.Column="0"
                           Text="Skąd płacisz:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="ExpenseSourceCombo"
                          Grid.Row="8" Grid.Column="1"
                          Height="28"
                          SelectionChanged="ExpenseSourceCombo_SelectionChanged">
                    <ComboBoxItem Content="Wolna gotówka"   Tag="cash_free"/>
                    <ComboBoxItem Content="Odłożona gotówka" Tag="cash_saved"/>
                    <ComboBoxItem Content="Koperta"          Tag="envelope"/>
                    <ComboBoxItem Content="Konto bankowe"    Tag="bank"/>
                </ComboBox>

                <!-- Koperta / Konto bankowe -->
                <StackPanel Grid.Row="10"
                            Grid.ColumnSpan="2"
                            Orientation="Vertical">

                    <!-- Wybór koperty (tylko przy opcji Koperta) -->
                    <Grid x:Name="ExpenseEnvelopeRow"
                          Visibility="Collapsed"
                          Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                                   Text="Koperta:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <ComboBox x:Name="ExpenseEnvelopeCombo"
                                  Grid.Column="1"
                                  Height="28"/>
                    </Grid>

                    <!-- Wybór konta bankowego (tylko przy opcji Konto bankowe) -->
                    <Grid x:Name="ExpenseBankRow"
                          Visibility="Collapsed">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                                   Text="Konto bankowe:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <ComboBox x:Name="ExpenseBankAccountCombo"
                                  Grid.Column="1"
                                  Height="28"/>
                    </Grid>
                </StackPanel>

                <!-- Opis -->
                <TextBlock Grid.Row="12" Grid.Column="0"
                           Text="Opis:"
                           VerticalAlignment="Top"
                           Margin="0,4,8,0"/>
                <TextBox x:Name="ExpenseDescBox"
                         Grid.Row="12" Grid.Column="1"
                         Height="80"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"/>

                <!-- Przyciski -->
                <StackPanel Grid.Row="14" Grid.ColumnSpan="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Content="Dodaj"
                            Margin="0,0,8,0"
                            Style="{StaticResource PrimaryButton}"
                            Click="SaveExpense_Click"/>
                    <Button Content="Anuluj"
                            Click="Cancel_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ========== PRZYCHÓD ========== -->
        <Border x:Name="IncomePanel"
                Grid.Row="4"
                Style="{StaticResource Card}"
                Margin="0,0,0,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <!-- kolejność: Kwota, Kategoria, Nowa kategoria, Data, Źródło, Forma, Konto, Opis, Przyciski -->
                    <RowDefinition Height="Auto"/>
                    <!-- 0 Kwota -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 2 Kategoria -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 4 Nowa kategoria -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 6 Data -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 8 Źródło -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 10 Forma -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 12 Konto (grid) -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 14 Opis -->
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 16 Przyciski -->
                </Grid.RowDefinitions>

                <!-- Kwota -->
                <TextBlock Grid.Row="0" Grid.Column="0"
                           Text="Kwota:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <StackPanel Grid.Row="0" Grid.Column="1">
                    <TextBox x:Name="IncomeAmountBox"
                             Height="28"/>
                    <TextBlock x:Name="IncomeAmountErrorText"
                               Style="{StaticResource ErrorTextStyle}"
                               Text="Podaj poprawną kwotę."/>
                </StackPanel>

                <!-- Kategoria -->
                <TextBlock Grid.Row="2" Grid.Column="0"
                           Text="Kategoria:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="IncomeCategoryBox"
                          Grid.Row="2" Grid.Column="1"
                          Height="28"
                          IsEditable="False"/>

                <!-- Nowa kategoria -->
                <TextBlock Grid.Row="4" Grid.Column="0"
                           Text="Nowa kategoria (opcjonalnie):"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBox x:Name="IncomeNewCategoryBox"
                         Grid.Row="4" Grid.Column="1"
                         Height="28"/>

                <!-- Data -->
                <TextBlock Grid.Row="6" Grid.Column="0"
                           Text="Data:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <DatePicker x:Name="IncomeDatePicker"
                            Grid.Row="6" Grid.Column="1"
                            Height="28"/>

                <!-- Źródło przychodu -->
                <TextBlock Grid.Row="8" Grid.Column="0"
                           Text="Źródło przychodu:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBox x:Name="IncomeSourceBox"
                         Grid.Row="8" Grid.Column="1"
                         Height="28"/>

                <!-- Forma przychodu -->
                <TextBlock Grid.Row="10" Grid.Column="0"
                           Text="Forma przychodu:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="IncomeFormTypeCombo"
                          Grid.Row="10" Grid.Column="1"
                          Height="28"
                          SelectionChanged="IncomeFormTypeCombo_SelectionChanged">
                    <ComboBoxItem Content="Wolna gotówka"   Tag="cash_free"/>
                    <ComboBoxItem Content="Odłożona gotówka" Tag="cash_saved"/>
                    <ComboBoxItem Content="Przelew"          Tag="transfer"/>
                </ComboBox>

                <!-- Na jakie konto trafia przychód (tylko przy przelewie) -->
                <Grid x:Name="IncomeAccountRow"
                      Grid.Row="12"
                      Grid.ColumnSpan="2"
                      Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="Na jakie konto trafia przychód:"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>
                    <ComboBox x:Name="IncomeAccountCombo"
                              Grid.Column="1"
                              Height="28"/>
                </Grid>

                <!-- Opis -->
                <TextBlock Grid.Row="14" Grid.Column="0"
                           Text="Opis:"
                           VerticalAlignment="Top"
                           Margin="0,4,8,0"/>
                <TextBox x:Name="IncomeDescBox"
                         Grid.Row="14" Grid.Column="1"
                         Height="80"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"/>

                <!-- Przyciski -->
                <StackPanel Grid.Row="16" Grid.ColumnSpan="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Content="Dodaj"
                            Margin="0,0,8,0"
                            Style="{StaticResource PrimaryButton}"
                            Click="SaveIncome_Click"/>
                    <Button Content="Anuluj"
                            Click="Cancel_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ========== TRANSFER ========== -->
        <Border x:Name="TransferPanel"
                Grid.Row="4"
                Style="{StaticResource Card}"
                Margin="0,0,0,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <!-- kolejność: Kwota, Kategoria, Nowa kategoria, Data, Z konta, Na konto, Opis, Przyciski -->
                    <RowDefinition Height="Auto"/>
                    <!-- 0 Kwota -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 2 Kategoria -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 4 Nowa kategoria -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 6 Data -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 8 Z konta -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 10 Na konto -->
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 12 Opis -->
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <!-- 14 Przyciski -->
                </Grid.RowDefinitions>

                <!-- Kwota -->
                <TextBlock Grid.Row="0" Grid.Column="0"
                           Text="Kwota:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <StackPanel Grid.Row="0" Grid.Column="1">
                    <TextBox x:Name="TransferAmountBox"
                             Height="28"/>
                    <TextBlock x:Name="TransferAmountErrorText"
                               Style="{StaticResource ErrorTextStyle}"
                               Text="Podaj poprawną kwotę."/>
                </StackPanel>

                <!-- Kategoria -->
                <TextBlock Grid.Row="2" Grid.Column="0"
                           Text="Kategoria:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="TransferCategoryBox"
                          Grid.Row="2" Grid.Column="1"
                          Height="28"
                          IsEditable="False"/>

                <!-- Nowa kategoria -->
                <TextBlock Grid.Row="4" Grid.Column="0"
                           Text="Nowa kategoria (opcjonalnie):"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBox x:Name="TransferNewCategoryBox"
                         Grid.Row="4" Grid.Column="1"
                         Height="28"/>

                <!-- Data -->
                <TextBlock Grid.Row="6" Grid.Column="0"
                           Text="Data:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <DatePicker x:Name="TransferDatePicker"
                            Grid.Row="6" Grid.Column="1"
                            Height="28"/>

                <!-- Z konta -->
                <TextBlock Grid.Row="8" Grid.Column="0"
                           Text="Z konta:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="TransferFromBox"
                          Grid.Row="8" Grid.Column="1"
                          Height="28"/>

                <!-- Na konto -->
                <TextBlock Grid.Row="10" Grid.Column="0"
                           Text="Na konto:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="TransferToBox"
                          Grid.Row="10" Grid.Column="1"
                          Height="28"/>

                <!-- Opis -->
                <TextBlock Grid.Row="12" Grid.Column="0"
                           Text="Opis:"
                           VerticalAlignment="Top"
                           Margin="0,4,8,0"/>
                <TextBox x:Name="TransferDescBox"
                         Grid.Row="12" Grid.Column="1"
                         Height="80"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"/>

                <!-- Przyciski -->
                <StackPanel Grid.Row="14" Grid.ColumnSpan="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Content="Zapisz transfer"
                            Margin="0,0,8,0"
                            Style="{StaticResource PrimaryButton}"
                            Click="SaveTransfer_Click"/>
                    <Button Content="Anuluj"
                            Click="Cancel_Click"/>
                </StackPanel>
            </Grid>
        </Border>

    </Grid>
</UserControl>
