<UserControl x:Class="Finly.Pages.CategoriesPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="340"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEWY PANEL: Kategorie -->
        <Border Grid.Column="0"
                Padding="12"
                Background="{DynamicResource Surface.Background}"
                BorderBrush="{DynamicResource Surface.Border}"
                BorderThickness="1"
                CornerRadius="8"
                VerticalAlignment="Stretch">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- header -->
                    <RowDefinition Height="Auto"/> <!-- search -->
                    <RowDefinition Height="*"/> <!-- list -->
                    <RowDefinition Height="Auto"/> <!-- add area -->
                    <RowDefinition Height="Auto"/> <!-- edit panel -->
                </Grid.RowDefinitions>

                <TextBlock Text="Kategorie"
                           FontSize="22"
                           FontWeight="Bold"
                           Foreground="{DynamicResource App.Foreground}"
                           Margin="0,0,0,12"/>

                <!-- Wyszukiwarka (nad listą) -->
                <TextBox x:Name="SearchBox"
                         Grid.Row="1"
                         Margin="0,0,0,10"
                         Height="28"
                         VerticalAlignment="Top"
                         TextChanged="SearchBox_TextChanged">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Setter Property="Foreground" Value="Gray"/>
                            <Setter Property="Text" Value="Szukaj kategorii..."/>
                            <Style.Triggers>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                                    <Setter Property="Text" Value=""/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <!-- Lista kategorii (wypełnia dostępną przestrzeń) -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="CategoriesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>

                                <Border Margin="0,4,0,4"
                                        Padding="8"
                                        Background="{DynamicResource Surface.Background}"
                                        BorderBrush="{DynamicResource Surface.Border}"
                                        BorderThickness="1"
                                        CornerRadius="6">
                                    <StackPanel>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Rectangle Width="12" Height="12"
                                                           Fill="{Binding ColorBrush}"
                                                           RadiusX="3" RadiusY="3"
                                                           Margin="0,0,8,0"/>
                                                <TextBlock Text="{Binding Name}"
                                                           VerticalAlignment="Center"
                                                           Foreground="{DynamicResource App.Foreground}"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1"
                                                        Orientation="Horizontal"
                                                        HorizontalAlignment="Right"
                                                        VerticalAlignment="Center">
                                                <!-- Edit icon (Segoe MDL2 Assets pencil) -->
                                                <Button Tag="{Binding}" Click="EditCategory_Click" ToolTip="Edytuj" Padding="6" Margin="0,0,8,0">
                                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE70F;" FontSize="14" Foreground="{DynamicResource App.Foreground}"/>
                                                </Button>
                                                <!-- Delete icon (Segoe MDL2 Assets delete) -->
                                                <Button Tag="{Binding}" Click="ShowDeleteConfirm_Click" ToolTip="Usuń" Padding="6">
                                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;" FontSize="14" Foreground="Tomato"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>

                                        <!-- inline confirmation (hidden by default) -->
                                        <Border x:Name="DeleteConfirmPanel" Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,8,0,0" Visibility="Collapsed">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBlock Text="Czy na pewno usunąć kategorię?" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                                <Button Tag="{Binding}" Click="DeleteConfirm_Click" Content="Tak" Width="60" Margin="0,0,8,0"/>
                                                <Button Click="DeleteCancel_Click" Content="Nie" Width="60"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Border>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Dodawanie kategorii -->
                <StackPanel Grid.Row="3" Orientation="Vertical" Margin="0,10,0,0">
                    <TextBlock Text="Dodaj kategorię" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}"/>
                    <DockPanel Margin="0,6,0,0">
                        <TextBox x:Name="NewCategoryBox" Height="28" DockPanel.Dock="Left" Width="260"/>
                        <Button Content="Dodaj" Width="80" Margin="8,0,0,0" Click="AddCategory_Click"/>
                    </DockPanel>
                    <TextBlock x:Name="MessageText" Margin="0,8,0,0" Foreground="OrangeRed" TextWrapping="Wrap"/>
                </StackPanel>

                <!-- Edit panel (na dole) -->
                <Border Grid.Row="4" x:Name="EditPanel" Background="{DynamicResource Surface.Background}" BorderBrush="{DynamicResource Surface.Border}" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,12,0,0" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="Edytuj kategorię" FontWeight="Bold" Foreground="{DynamicResource App.Foreground}"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBox x:Name="EditNameBox" Width="260" Height="28" />
                            <Button Content="Zapisz" Width="80" Margin="8,0,0,0" Click="SaveEdit_Click"/>
                            <Button Content="Anuluj" Width="80" Margin="8,0,0,0" Click="CancelEdit_Click"/>
                        </StackPanel>
                        <TextBlock x:Name="EditPanelMessage" Foreground="OrangeRed" Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>

            </Grid>

        </Border>

        <!-- PRAWY PANEL: Wykresy -->
        <StackPanel Grid.Column="2" Orientation="Vertical">

            <!-- Wykres1 -->
            <Border Padding="12"
                    Background="{DynamicResource Surface.Background}"
                    BorderBrush="{DynamicResource Surface.Border}"
                    BorderThickness="1"
                    CornerRadius="8">

                <StackPanel>
                    <TextBlock Text="Wydatki wg kategorii (30 dni)"
                               FontWeight="Bold"
                               Foreground="{DynamicResource App.Foreground}"
                               Margin="0,0,0,10"/>

                    <ItemsControl x:Name="SpendingChart">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,6,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                    <Border Grid.Column="1" Background="#303030" Height="18" CornerRadius="4" VerticalAlignment="Center" Margin="8,0">
                                        <Rectangle Fill="{Binding Brush}" Width="{Binding BarWidth}" Height="18" RadiusX="4" RadiusY="4"/>
                                    </Border>
                                    <TextBlock Grid.Column="2" Text="{Binding Amount, StringFormat={}{0:N2} zł}" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

            </Border>

            <!-- Wykres2 -->
            <Border Padding="12"
                    Background="{DynamicResource Surface.Background}"
                    BorderBrush="{DynamicResource Surface.Border}"
                    BorderThickness="1"
                    CornerRadius="8" Margin="0,12,0,0">

                <StackPanel>
                    <TextBlock Text="Przychody wg kategorii (30 dni)"
                               FontWeight="Bold"
                               Foreground="{DynamicResource App.Foreground}"
                               Margin="0,0,0,10"/>

                    <ItemsControl x:Name="IncomeChart">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,6,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                    <Border Grid.Column="1" Background="#303030" Height="18" CornerRadius="4" VerticalAlignment="Center" Margin="8,0">
                                        <Rectangle Fill="{Binding Brush}" Width="{Binding BarWidth}" Height="18" RadiusX="4" RadiusY="4"/>
                                    </Border>
                                    <TextBlock Grid.Column="2" Text="{Binding Amount, StringFormat={}{0:N2} zł}" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

            </Border>

        </StackPanel>

    </Grid>
</UserControl>
