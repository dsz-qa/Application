<UserControl x:Class="Finly.Pages.TransactionsPage"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:views="clr-namespace:Finly.Views.Controls"
 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
 mc:Ignorable="d">
 <UserControl.Resources>
 <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

 <!-- KPI styles -->
 <Style x:Key="KpiValueStyle" TargetType="TextBlock">
 <Setter Property="FontSize" Value="18"/>
 <Setter Property="FontWeight" Value="Bold"/>
 <Setter Property="Margin" Value="0,2,0,0"/>
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 </Style>
 <Style x:Key="KpiHeader" TargetType="TextBlock">
 <Setter Property="FontSize" Value="20"/>
 <Setter Property="FontWeight" Value="Bold"/>
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 <Setter Property="Opacity" Value="1"/>
 </Style>

 <!-- Accent card -->
 <Style x:Key="AccentCard" TargetType="Border">
 <Setter Property="Background" Value="Transparent"/>
 <Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
 <Setter Property="BorderThickness" Value="2"/>
 <Setter Property="CornerRadius" Value="10"/>
 <Setter Property="Padding" Value="12"/>
 <Setter Property="Margin" Value="0,0,16,0"/>
 </Style>

 <!-- Transaction cards -->
 <Style x:Key="TransactionCard" TargetType="Border">
 <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
 <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
 <Setter Property="BorderThickness" Value="1"/>
 <Setter Property="CornerRadius" Value="10"/>
 <Setter Property="Padding" Value="12"/>
 <Setter Property="Margin" Value="0,0,16,12"/>
 <Setter Property="SnapsToDevicePixels" Value="True"/>
 <Setter Property="Effect">
 <Setter.Value>
 <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.16"/>
 </Setter.Value>
 </Setter>
 <Style.Triggers>
 <Trigger Property="IsMouseOver" Value="True">
 <Setter Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
 </Trigger>
 </Style.Triggers>
 </Style>

 <Style x:Key="TransactionCardPlanned" TargetType="Border" BasedOn="{StaticResource TransactionCard}">
 <Style.Triggers>
 <DataTrigger Binding="{Binding IsPlanned}" Value="True">
 <Setter Property="Opacity" Value="0.85"/>
 </DataTrigger>
 </Style.Triggers>
 </Style>

 <Style x:Key="PlannedLabelStyle" TargetType="TextBlock">
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 <Setter Property="Opacity" Value="0.7"/>
 <Setter Property="FontSize" Value="12"/>
 <Setter Property="FontWeight" Value="SemiBold"/>
 </Style>

 <!-- Period option -->
 <Style x:Key="PeriodOptionStyle" TargetType="RadioButton">
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 <Setter Property="FontSize" Value="13"/>
 <Setter Property="FontWeight" Value="SemiBold"/>
 <Setter Property="Margin" Value="0,0,12,0"/>
 <Setter Property="Padding" Value="14,6"/>
 <Setter Property="Cursor" Value="Hand"/>
 <Setter Property="Template">
 <Setter.Value>
 <ControlTemplate TargetType="RadioButton">
 <Border x:Name="Bd" CornerRadius="8" BorderThickness="1" BorderBrush="{DynamicResource Btn.Border}" Background="{DynamicResource Btn.Background}">
 <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
 </Border>
 <ControlTemplate.Triggers>
 <Trigger Property="IsMouseOver" Value="True">
 <Setter TargetName="Bd" Property="Background" Value="{DynamicResource Btn.Hover}"/>
 </Trigger>
 <Trigger Property="IsChecked" Value="True">
 <Setter TargetName="Bd" Property="Background" Value="{DynamicResource Accent}"/>
 <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource Accent}"/>
 <Setter Property="Foreground" Value="{DynamicResource Accent.Foreground}"/>
 <Setter Property="FontWeight" Value="Bold"/>
 </Trigger>
 <Trigger Property="IsEnabled" Value="False">
 <Setter TargetName="Bd" Property="Opacity" Value="0.5"/>
 </Trigger>
 </ControlTemplate.Triggers>
 </ControlTemplate>
 </Setter.Value>
 </Setter>
 </Style>

 <!-- Filter checkbox style -->
 <Style x:Key="FilterCheckBoxStyle" TargetType="CheckBox">
 <Setter Property="FontSize" Value="15"/>
 <Setter Property="FontWeight" Value="SemiBold"/>
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 <Setter Property="Cursor" Value="Hand"/>
 <Setter Property="Padding" Value="8,6"/>
 <Setter Property="Margin" Value="0,4,0,4"/>
 <Setter Property="MinHeight" Value="32"/>
 <Setter Property="VerticalContentAlignment" Value="Center"/>
 <Setter Property="HorizontalContentAlignment" Value="Left"/>
 </Style>

 <!-- Filter panel with fixed height (content scrolls inside) -->
 <Style x:Key="FilterPanelStyle" TargetType="GroupBox">
 <Setter Property="Height" Value="220"/>
 <Setter Property="MinHeight" Value="220"/>
 <Setter Property="Margin" Value="0,0,16,0"/>
 <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
 <Setter Property="Background" Value="Transparent"/>
 <Setter Property="BorderBrush" Value="{DynamicResource Brand.Orange}"/>
 <Setter Property="BorderThickness" Value="2"/>
 <Setter Property="Template">
 <Setter.Value>
 <ControlTemplate TargetType="GroupBox">
 <Grid Height="{TemplateBinding Height}" ClipToBounds="True">
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 </Grid.RowDefinitions>
 <TextBlock Grid.Row="0" Text="{TemplateBinding Header}" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource App.Foreground}" Margin="0,0,0,6"/>
 <Border Grid.Row="1" Background="{DynamicResource Surface.Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="10" Padding="10" SnapsToDevicePixels="True">
 <ContentPresenter VerticalAlignment="Stretch" HorizontalAlignment="Stretch"/>
 </Border>
 </Grid>
 </ControlTemplate>
 </Setter.Value>
 </Setter>
 </Style>
 </UserControl.Resources>

 <Grid>
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 </Grid.RowDefinitions>

 <!-- KPI row -->
 <Grid Grid.Row="0" Margin="16">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="*"/>
 </Grid.ColumnDefinitions>
 <Border Grid.Column="0" Style="{StaticResource AccentCard}">
 <StackPanel>
 <TextBlock Text="Suma wydatków" Style="{StaticResource KpiHeader}"/>
 <TextBlock Text="{Binding TotalExpenses, StringFormat={}{0:N2} zł}" Style="{StaticResource KpiValueStyle}"/>
 </StackPanel>
 </Border>
 <Border Grid.Column="1" Style="{StaticResource AccentCard}">
 <StackPanel>
 <TextBlock Text="Suma przychodów" Style="{StaticResource KpiHeader}"/>
 <TextBlock Text="{Binding TotalIncomes, StringFormat={}{0:N2} zł}" Style="{StaticResource KpiValueStyle}"/>
 </StackPanel>
 </Border>
 <Border Grid.Column="2" Style="{StaticResource AccentCard}">
 <StackPanel>
 <TextBlock Text="Bilans" Style="{StaticResource KpiHeader}"/>
 <TextBlock Text="{Binding Balance, StringFormat={}{0:N2} zł}" Style="{StaticResource KpiValueStyle}"/>
 </StackPanel>
 </Border>
 </Grid>

 <!-- Period bar -->
 <views:PeriodBarControl Grid.Row="1" x:Name="PeriodBar" Margin="16,0,16,12" RangeChanged="PeriodBar_RangeChanged"/>

 <!-- Filters row (fixed height panels, internal scroll) -->
 <Grid Grid.Row="2" Margin="16,0,16,12">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="*"/>
 </Grid.ColumnDefinitions>

 <!-- Typ transakcji -->
 <GroupBox Style="{StaticResource FilterPanelStyle}" Grid.Column="0" Header="Typ transakcji">
 <ScrollViewer VerticalScrollBarVisibility="Auto">
 <StackPanel>
 <CheckBox Style="{StaticResource FilterCheckBoxStyle}" Content="Wydatki" IsChecked="{Binding ShowExpenses, Mode=TwoWay}"/>
 <CheckBox Style="{StaticResource FilterCheckBoxStyle}" Content="Przychody" IsChecked="{Binding ShowIncomes, Mode=TwoWay}"/>
 <CheckBox Style="{StaticResource FilterCheckBoxStyle}" Content="Transfery" IsChecked="{Binding ShowTransfers, Mode=TwoWay}"/>
 </StackPanel>
 </ScrollViewer>
 </GroupBox>

 <!-- Kategorie -->
 <GroupBox Style="{StaticResource FilterPanelStyle}" Grid.Column="1" Header="Kategorie">
 <ScrollViewer VerticalScrollBarVisibility="Auto">
 <ItemsControl ItemsSource="{Binding Categories}">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <CheckBox Style="{StaticResource FilterCheckBoxStyle}" Content="{Binding Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}"/>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 </ScrollViewer>
 </GroupBox>

 <!-- Konta -->
 <GroupBox Style="{StaticResource FilterPanelStyle}" Grid.Column="2" Header="Konta">
 <ScrollViewer VerticalScrollBarVisibility="Auto">
 <ItemsControl ItemsSource="{Binding Accounts}">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <CheckBox Style="{StaticResource FilterCheckBoxStyle}" Content="{Binding Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}"/>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 </ScrollViewer>
 </GroupBox>
 </Grid>

 <!-- Transactions lists -->
 <Grid Grid.Row="3" Margin="16">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="*"/>
 </Grid.ColumnDefinitions>

 <!-- Realized -->
 <Border Grid.Column="0" Style="{StaticResource AccentCard}" Margin="0,0,8,0" Padding="12">
 <Grid>
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 </Grid.RowDefinitions>
 <TextBlock Grid.Row="0" Text="Transakcje" Style="{StaticResource KpiHeader}" Margin="0,0,0,8"/>
 <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
 <ItemsControl ItemsSource="{Binding FilteredTransactions}">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Border x:Name="RealizedCard" Style="{StaticResource TransactionCardPlanned}">
 <Grid>
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="Auto"/>
 </Grid.ColumnDefinitions>
 <StackPanel Grid.Column="0" Margin="4,0,8,0">
 <TextBlock Text="{Binding CategoryName}" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}"/>
 <StackPanel Orientation="Horizontal">
 <TextBlock Text="{Binding Description}" Foreground="{DynamicResource App.Foreground}" Opacity="0.9" TextTrimming="CharacterEllipsis"/>
 <TextBlock Text="Zaplanowana" Margin="8,0,0,0" Visibility="{Binding IsPlanned, Converter={StaticResource BoolToVisibilityConverter}}" Style="{StaticResource PlannedLabelStyle}"/>
 </StackPanel>
 <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
 <TextBlock Text="{Binding AccountName}" Foreground="{DynamicResource App.Foreground}"/>
 <TextBlock Text=" • " Foreground="{DynamicResource App.Foreground}" Opacity="0.6" Margin="6,0"/>
 <TextBlock Text="{Binding DateDisplay}" Foreground="{DynamicResource App.Foreground}"/>
 <TextBlock Text=" • " Foreground="{DynamicResource App.Foreground}" Opacity="0.6" Margin="6,0"/>
 <TextBlock Text="{Binding AmountStr}" Foreground="{DynamicResource App.Foreground}" FontWeight="Bold"/>
 </StackPanel>
 </StackPanel>
 <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
 <Button Style="{StaticResource TitleBarIconButton}" Margin="0,0,6,0" ToolTip="Edytuj">
 <Image Source="/Assets/Images/edit.png" Width="20" Height="20" Stretch="Uniform"/>
 </Button>
 <Button Style="{StaticResource TitleBarIconButton}" ToolTip="Usuń">
 <Image Source="/Assets/Images/delete.png" Width="20" Height="20" Stretch="Uniform"/>
 </Button>
 </StackPanel>
 </Grid>
 </Border>
 <DataTemplate.Triggers>
 <DataTrigger Binding="{Binding IsPlanned}" Value="True">
 <Setter TargetName="RealizedCard" Property="Visibility" Value="Collapsed"/>
 </DataTrigger>
 <DataTrigger Binding="{Binding IsFuture}" Value="True">
 <Setter TargetName="RealizedCard" Property="Visibility" Value="Collapsed"/>
 </DataTrigger>
 </DataTemplate.Triggers>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 </ScrollViewer>
 </Grid>
 </Border>

 <!-- Scheduled -->
 <Border Grid.Column="1" Style="{StaticResource AccentCard}" Margin="8,0,0,0" Padding="12" Visibility="{Binding ShowScheduled, Converter={StaticResource BoolToVisibilityConverter}}">
 <Grid>
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 </Grid.RowDefinitions>
 <TextBlock Grid.Row="0" Text="Zaplanowane transakcje" Style="{StaticResource KpiHeader}" Margin="0,0,0,8"/>
 <!-- Tymczasowy licznik -->
 <TextBlock Grid.Row="1" Text="{Binding PlannedTransactions.Count, StringFormat=Zaplanowanych: {0}}" Foreground="{DynamicResource App.Foreground}" Margin="0,0,0,8"/>
 <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
 <ItemsControl ItemsSource="{Binding PlannedTransactions}">
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Border x:Name="ScheduledCard" Style="{StaticResource TransactionCardPlanned}">
 <Grid>
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="Auto"/>
 </Grid.ColumnDefinitions>
 <StackPanel Grid.Column="0" Margin="4,0,8,0">
 <TextBlock Text="{Binding CategoryName}" FontWeight="SemiBold" Foreground="{DynamicResource App.Foreground}"/>
 <StackPanel Orientation="Horizontal">
 <TextBlock Text="{Binding Description}" Foreground="{DynamicResource App.Foreground}" Opacity="0.9" TextTrimming="CharacterEllipsis"/>
 <TextBlock Text="Zaplanowana" Margin="8,0,0,0" Style="{StaticResource PlannedLabelStyle}"/>
 </StackPanel>
 <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
 <TextBlock Text="{Binding AccountName}" Foreground="{DynamicResource App.Foreground}"/>
 <TextBlock Text=" • " Foreground="{DynamicResource App.Foreground}" Opacity="0.6" Margin="6,0"/>
 <TextBlock Text="{Binding DateDisplay}" Foreground="{DynamicResource App.Foreground}"/>
 <TextBlock Text=" • " Foreground="{DynamicResource App.Foreground}" Opacity="0.6" Margin="6,0"/>
 <TextBlock Text="{Binding AmountStr}" Foreground="{DynamicResource App.Foreground}" FontWeight="Bold"/>
 </StackPanel>
 </StackPanel>
 <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
 <Button Style="{StaticResource TitleBarIconButton}" Margin="0,0,6,0" ToolTip="Edytuj">
 <Image Source="/Assets/Images/edit.png" Width="20" Height="20" Stretch="Uniform"/>
 </Button>
 <Button Style="{StaticResource TitleBarIconButton}" ToolTip="Usuń">
 <Image Source="/Assets/Images/delete.png" Width="20" Height="20" Stretch="Uniform"/>
 </Button>
 </StackPanel>
 </Grid>
 </Border>
 <!-- Ukrywanie kart, które nie są planowane/future nie jest potrzebne, bo źródło to tylko PlannedTransactions -->
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 </ScrollViewer>
 </Grid>
 </Border>
 </Grid>
 </Grid>
</UserControl>












































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































