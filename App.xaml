<Application x:Class="Finly.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:Finly.Helpers.Converters"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             Startup="Application_Startup"
             ShutdownMode="OnMainWindowClose">

    <Application.Resources>
        <ResourceDictionary>

            <!-- ========= STYLE + MOTYW ========= -->
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/_Index.xaml"/>
                <ResourceDictionary Source="/Themes/Dark.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- ========= KONWERTERY ========= -->
            <!-- Upewnij się, że klasy są w namespace: Finly.Helpers.Converters -->
            <conv:BoolToBrushConverter             x:Key="BoolToBrush"/>
            <conv:BoolToSymbolConverter            x:Key="BoolToSymbol"/>
            <conv:BoolToVisibilityConverter        x:Key="BoolToVisibility"/>
            <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>

            <!-- ========= COMBOBOX – CIEMNA LISTA ========= -->

            <!-- Pozycje na liście -->
            <Style x:Key="DarkComboBoxItemStyle" TargetType="ComboBoxItem">
                <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Padding"    Value="6,2"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="VerticalContentAlignment"   Value="Center"/>
                <Setter Property="SnapsToDevicePixels"        Value="True"/>

                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#303030"/>
                    </Trigger>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource Brand.Blue.HoverOverlay}"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Opacity" Value="0.6"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Pole ComboBoxa + popup -->
            <Style TargetType="ComboBox">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="6,2"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="SnapsToDevicePixels" Value="True"/>
                <Setter Property="ItemContainerStyle" Value="{StaticResource DarkComboBoxItemStyle}"/>

                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Grid>
                                <!-- Główne pole -->
                                <ToggleButton x:Name="ToggleButton"
                                              Focusable="False"
                                              IsChecked="{Binding IsDropDownOpen, Mode=TwoWay,
                                                                  RelativeSource={RelativeSource TemplatedParent}}"
                                              ClickMode="Press"
                                              Background="{TemplateBinding Background}"
                                              BorderBrush="{TemplateBinding BorderBrush}"
                                              BorderThickness="{TemplateBinding BorderThickness}"
                                              HorizontalContentAlignment="Stretch"
                                              HorizontalAlignment="Stretch">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="24"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Wybrana wartość -->
                                        <ContentPresenter
                                            Margin="4,2,4,2"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left"
                                            Content="{TemplateBinding SelectionBoxItem}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                            RecognizesAccessKey="True"/>

                                        <!-- Strzałka SKRAJNIE po prawej -->
                                        <Border Grid.Column="1"
                                                Background="#33000000"
                                                HorizontalAlignment="Right"
                                                Margin="0">
                                            <Path HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  Data="M 0 0 L 4 4 L 8 0 Z"
                                                  Fill="{DynamicResource App.Foreground}"
                                                  Stretch="Uniform"
                                                  Width="10"
                                                  Height="6"/>
                                        </Border>
                                    </Grid>
                                </ToggleButton>

                                <!-- Popup listy -->
                                <Popup x:Name="Popup"
                                       Placement="Bottom"
                                       IsOpen="{TemplateBinding IsDropDownOpen}"
                                       AllowsTransparency="True"
                                       Focusable="False"
                                       PopupAnimation="Fade">
                                    <Border Margin="0,2,0,0"
                                            Background="{DynamicResource Surface.Background}"
                                            BorderBrush="{DynamicResource Surface.Border}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            SnapsToDevicePixels="True">
                                        <ScrollViewer Margin="0,2"
                                                      SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True"
                                                        KeyboardNavigation.DirectionalNavigation="Contained"/>
                                        </ScrollViewer>
                                    </Border>
                                </Popup>
                            </Grid>

                            <ControlTemplate.Triggers>
                                <Trigger Property="HasItems" Value="False">
                                    <Setter TargetName="Popup" Property="MinHeight" Value="0"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Opacity" Value="0.5"/>
                                </Trigger>
                                <!-- brak niebieskiego wypełnienia; tylko ramka może być niebieska -->
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ToggleButton"
                                            Property="BorderBrush"
                                            Value="{DynamicResource Brand.Blue}"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                    <Setter TargetName="ToggleButton"
                                            Property="BorderBrush"
                                            Value="{DynamicResource Brand.Blue}"/>
                                </Trigger>
                                <Trigger Property="IsDropDownOpen" Value="True">
                                    <Setter TargetName="ToggleButton"
                                            Property="BorderBrush"
                                            Value="{DynamicResource Brand.Blue}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ========= DATEPICKER – własny szablon, DZIAŁAJĄCY ========= -->

            <!-- Tekst DatePickera -->
            <Style TargetType="{x:Type DatePickerTextBox}">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background" Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="4,2"/>
            </Style>

            <!-- Sam DatePicker – ciemne pole + nasz kalendarz -->
            <Style TargetType="DatePicker">
                <Setter Property="Foreground"      Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush"     Value="{DynamicResource Brand.Blue}"/>
                <Setter Property="BorderThickness" Value="1.5"/>

                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DatePicker">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Pole tekstowe -->
                                <DatePickerTextBox x:Name="PART_TextBox"
                                                   Grid.Column="0"
                                                   Margin="0"
                                                   Focusable="False"
                                                   Background="{TemplateBinding Background}"
                                                   Foreground="{TemplateBinding Foreground}"/>

                                <!-- Przycisk z ikonką kalendarza -->
                                <!-- UWAGA: BEZ żadnego Command – DatePicker sam ogarnia PART_Button -->
                                <Button x:Name="PART_Button"
                                        Grid.Column="1"
                                        Margin="0"
                                        Padding="4"
                                        Focusable="False"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Image Source="/Assets/Icons/kalendarz.png"
                                           Width="22"
                                           Height="22"
                                           Stretch="Uniform"
                                           RenderOptions.BitmapScalingMode="HighQuality"/>
                                </Button>

                                <!-- Popup z kalendarzem -->
                                <Popup x:Name="PART_Popup"
                                       Placement="Bottom"
                                       IsOpen="{Binding IsDropDownOpen,
                                                        RelativeSource={RelativeSource TemplatedParent}}"
                                       AllowsTransparency="True"
                                       Focusable="False"
                                       PopupAnimation="Fade">
                                    <Border Margin="0,2,0,0"
                                            Background="{DynamicResource Surface.Background}"
                                            BorderBrush="{DynamicResource Surface.Border}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            SnapsToDevicePixels="True">
                                        <Calendar x:Name="PART_Calendar"
                                                  Background="{DynamicResource Surface.Background}"
                                                  Foreground="{DynamicResource App.Foreground}"
                                                  BorderThickness="0"
                                                  SelectedDate="{Binding SelectedDate,
                                                                         RelativeSource={RelativeSource TemplatedParent},
                                                                         Mode=TwoWay}"
                                                  DisplayDate="{Binding DisplayDate,
                                                                        RelativeSource={RelativeSource TemplatedParent},
                                                                        Mode=TwoWay}"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ========= GLOBALNE POLA TEKSTOWE ========= -->
            <Style TargetType="TextBox">
                <Setter Property="Foreground"      Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush"     Value="{DynamicResource Surface.Border}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding"         Value="4,2"/>
            </Style>

            <!-- ========= LISTY / TABELKI / GRUPY ========= -->
            <Style TargetType="GroupBox">
                <Setter Property="Foreground"      Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush"     Value="{DynamicResource Surface.Border}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Margin"          Value="0,4,0,4"/>
            </Style>

            <Style TargetType="ListBox">
                <Setter Property="Background"  Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Surface.Border}"/>
                <Setter Property="Foreground"  Value="{DynamicResource App.Foreground}"/>
            </Style>

            <Style TargetType="DataGrid">
                <Setter Property="Background"               Value="{DynamicResource Surface.Background}"/>
                <Setter Property="Foreground"               Value="{DynamicResource App.Foreground}"/>
                <Setter Property="BorderBrush"              Value="{DynamicResource Surface.Border}"/>
                <Setter Property="RowBackground"            Value="#232323"/>
                <Setter Property="AlternatingRowBackground" Value="#272727"/>
                <Setter Property="HorizontalGridLinesBrush" Value="#444444"/>
                <Setter Property="VerticalGridLinesBrush"   Value="#444444"/>
            </Style>

            <!-- ========= CIEMNY TABCONTROL (Wydatek / Przychód / Transfer) ========= -->
            <Style TargetType="TabControl">
                <Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush"     Value="{DynamicResource Surface.Border}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding"         Value="0"/>
            </Style>

            <Style TargetType="TabItem">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Padding"    Value="12,4"/>
                <Setter Property="Margin"     Value="0,0,4,0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{DynamicResource Surface.Border}"
                                    BorderThickness="1"
                                    CornerRadius="6,6,0,0"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="Bd" Property="Background"  Value="#303030"/>
                                    <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource Brand.Blue}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="#262626"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Opacity" Value="0.6"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ========= FONTY / TEKST ========= -->
            <FontFamily x:Key="App.FontFamily">Segoe UI</FontFamily>
            <sys:Double x:Key="App.FontSize">14</sys:Double>

            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="FontFamily" Value="{StaticResource App.FontFamily}"/>
                <Setter Property="FontSize"   Value="{StaticResource App.FontSize}"/>
            </Style>

            <Style TargetType="Label">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            </Style>

            <Style TargetType="{x:Type TextElement}">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
            </Style>

            <!-- ========= BAZOWE OKNA / KONTROLKI ========= -->
            <Style TargetType="Window">
                <Setter Property="Background" Value="{DynamicResource App.Background}"/>
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="FontFamily" Value="Segoe UI"/>
                <Setter Property="ResizeMode" Value="CanResize"/>
                <Setter Property="MinWidth"  Value="1100"/>
                <Setter Property="MinHeight" Value="700"/>
            </Style>

            <Style TargetType="UserControl">
                <Setter Property="Background" Value="{DynamicResource App.Background}"/>
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="FontFamily" Value="Segoe UI"/>
            </Style>

            <Style TargetType="Grid">
                <Setter Property="Background" Value="{DynamicResource App.Background}"/>
            </Style>

            <Style TargetType="Border">
                <Setter Property="Background"      Value="{DynamicResource Surface.Background}"/>
                <Setter Property="BorderBrush"     Value="{DynamicResource Surface.Border}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius"    Value="8"/>
            </Style>

            <!-- ========= SidebarNavButton ========= -->
            <Style x:Key="SidebarNavButton"
                   TargetType="Button"
                   BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Foreground" Value="{DynamicResource App.Foreground}"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="Padding" Value="10,8"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    CornerRadius="8"
                                    BorderThickness="0">
                                <StackPanel Orientation="Horizontal">
                                    <Image Width="18" Height="18"
                                           Source="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Tag}"
                                           Stretch="Uniform"
                                           VerticalAlignment="Center"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           SnapsToDevicePixels="True"
                                           Margin="0,0,8,0"/>
                                    <ContentPresenter VerticalAlignment="Center"
                                                      RecognizesAccessKey="True"/>
                                </StackPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#1AFFFFFF"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="#26FFFFFF"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Opacity" Value="0.5"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

        </ResourceDictionary>
    </Application.Resources>
</Application>










